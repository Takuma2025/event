<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Åè„ÅòÂºï„ÅçWEB„Çµ„Éº„Éì„Çπ</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: white;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        /* ÊôØÂìÅÁîªÂÉè„ÅÆ„Çπ„Çø„Ç§„É´ */
        .keihin-decoration {
            position: fixed;
            z-index: 1;
        }

        .keihin-decoration img {
            width: 120px;
            height: 120px;
            object-fit: contain;
        }

        /* ÂÄãÂà•„ÅÆÊôØÂìÅÁîªÂÉèÈÖçÁΩÆ */
        .keihin-1 {
            top: 20px;
            left: 20px;
            transform: rotate(-15deg);
        }

        .keihin-2 {
            top: 20px;
            right: 20px;
            transform: rotate(15deg);
        }

        .keihin-3 {
            top: 200px;
            left: 20px;
            transform: rotate(-10deg);
        }

        .keihin-4 {
            top: 200px;
            right: 20px;
            transform: rotate(10deg);
        }

        .keihin-5 {
            bottom: 20px;
            left: 20px;
            transform: rotate(20deg);
        }

        .keihin-6 {
            bottom: 20px;
            right: 20px;
            transform: rotate(-20deg);
        }



        /* „Åè„ÅòÈÅ∏„Å≥ÁîªÈù¢„Åß„ÅØÊôØÂìÅÁîªÂÉè„ÇíÈùûË°®Á§∫ */
        .hide-keihin .keihin-decoration {
            display: none;
        }

        /* „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥ÊôÇ„ÅØÂΩìÈÅ∏ËÄÖÊï∞Ë°®Á§∫„ÇíÈùûË°®Á§∫ */
        .hide-winner-count .winner-count-title {
            display: none;
        }

        /* „É¢„Éê„Ç§„É´ÂØæÂøú */
        @media (max-width: 768px) {
            .keihin-decoration {
                display: none;
            }
        }



        .title {
            text-align: center;
            margin-bottom: 30px;
        }

        .title img {
            max-width: 400px;
            height: auto;
        }

        .logo {
            max-width: 200px !important;
            width: 200px !important;
            height: auto !important;
            margin: 0 auto 5px auto !important;
            display: block !important;
        }

        .title-content {
            display: flex;
            flex-direction: column;
            flex-wrap: nowrap;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .title-main {
            max-width: 350px;
            width: 350px;
            height: auto;
            flex-shrink: 0;
        }

        .kujibox {
            max-width: 200px;
            width: 200px;
            height: auto;
            flex-shrink: 0;
        }

        .date-display {
            text-align: center;
            color: #666;
            font-size: 1.2em;
            margin-bottom: 20px;
            font-weight: normal;
        }

        .winner-count-title {
            text-align: center;
            font-size: 2.2em;
            font-weight: bold;
            color: #000;
            margin-bottom: 20px;
        }

        #total-winners {
            font-family: 'Century', 'Times New Roman', serif;
            font-size: 2.5em;
            font-weight: 900;
            color: #e91e63;
            letter-spacing: 2px;
            display: inline-block;
            animation: number-dance 3s ease-in-out infinite;
        }















        .draw-counter {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            animation: pulse-glow 2s infinite;
        }

        .draw-counter.warning {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            box-shadow: 0 4px 15px rgba(255, 107, 107, 0.3);
        }

        .draw-counter.limited {
            background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }

        @keyframes pulse-glow {
            0%, 100% { 
                transform: scale(1);
                box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
            }
            50% { 
                transform: scale(1.02);
                box-shadow: 0 6px 20px rgba(76, 175, 80, 0.5);
            }
        }

        .count-numbers {
            font-size: 2em;
            margin: 10px 0;
        }

        .remaining-count {
            color: #ffd700;
            font-weight: bold;
        }



        .celebration {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #ff6b6b;
            animation: confetti-fall 3s linear infinite;
        }

        .confetti:nth-child(2n) { background-color: #4ecdc4; }
        .confetti:nth-child(3n) { background-color: #45b7d1; }
        .confetti:nth-child(4n) { background-color: #f9ca24; }
        .confetti:nth-child(5n) { background-color: #6c5ce7; }
        .confetti:nth-child(6n) { background-color: #00d2b8; }
        .confetti:nth-child(7n) { background-color: #ff6b6b; }
        .confetti:nth-child(8n) { background-color: #1dd1a1; }
        .confetti:nth-child(9n) { background-color: #ffa502; }

        @keyframes confetti-fall {
            0% {
                transform: translateY(-100vh) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0;
            }
        }

        .sparkle {
            position: absolute;
            width: 28px;
            height: 28px;
            color: #00d2b8;
            animation: sparkle 2s infinite;
            font-size: 28px;
            line-height: 28px;
            text-align: center;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0); }
            50% { opacity: 1; transform: scale(1); }
        }

        .kuji-container {
            position: relative;
            height: 80vh;
            width: 100%;
            margin: 20px auto;
            padding: 20px;
            box-sizing: border-box;
        }

        .kuji-item {
            position: absolute;
            cursor: pointer;
            transition: all 1s ease;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }

        .kuji-item:hover {
            transform: scale(1.2) rotate(5deg);
            filter: drop-shadow(0 8px 16px rgba(0,0,0,0.4));
        }



        .kuji-item img {
            max-width: 130px;
            height: auto;
            border-radius: 10px;
        }



        .result-container {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .result-image {
            max-width: 250px;
            height: auto;
            margin: 20px 0;
            border-radius: 15px;
        }

        .result-text {
            color: #d32f2f;
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.2;
            border: 4px solid #ff6b6b;
            padding: 20px;
            border-radius: 15px;
            background: white;
        }

        .result-text.result-miss-text {
            border: none;
            padding: 0;
            background: transparent;
            color: #666;
        }

        .winner-info {
            color: #000;
            font-size: 1.4em;
            margin: 20px 0;
            padding: 15px;
            background: none;
            border-radius: 10px;
            border: none;
        }

        .settings-icon {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: #718096;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 1001;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }

        .settings-icon:hover {
            background: #4a5568;
            transform: scale(1.1);
        }

        .settings-icon svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .admin-panel {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 1002;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .password-container {
            text-align: center;
            padding: 20px;
        }

        .password-title {
            font-size: 1.2em;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .password-input {
            width: 250px;
            padding: 12px 15px;
            font-size: 1.1em;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            margin-bottom: 20px;
            text-align: center;
        }

        .password-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .password-submit-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            display: block;
            margin: 0 auto;
            transition: background 0.3s ease;
        }

        .password-submit-btn:hover {
            background: #45a049;
        }

        .password-error {
            color: #f56565;
            font-size: 0.9em;
            margin-top: 15px;
            padding: 10px;
            background: #fed7d7;
            border-radius: 6px;
            border: 1px solid #feb2b2;
        }

        .admin-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            width: 800px;
        }

        .admin-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 15px;
        }

        .admin-title {
            font-size: 1.8em;
            font-weight: bold;
            color: #2d3748;
        }

        .close-btn {
            background: #f56565;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
        }

        .close-btn:hover {
            background: #e53e3e;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        .admin-table th,
        .admin-table td {
            border: 1px solid #e2e8f0;
            padding: 12px;
            text-align: left;
        }

        .admin-table th:nth-child(1),
        .admin-table td:nth-child(1) {
            min-width: 120px;
        }

        .admin-table th:nth-child(n+2),
        .admin-table td:nth-child(n+2) {
            min-width: 80px;
            text-align: center;
        }

        .admin-table th {
            background: #f7fafc;
            font-weight: bold;
            color: #2d3748;
        }

        .admin-table tr:nth-child(even) {
            background: #f9f9f9;
        }

        .admin-table tr:hover {
            background: #edf2f7;
        }



        .status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            font-weight: bold;
        }

        .status-won {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-lost {
            background: #fed7d7;
            color: #742a2a;
        }

        .prize-settings {
            margin-top: 30px;
            border-top: 2px solid #e2e8f0;
            padding-top: 20px;
            background: linear-gradient(135deg, #ebf8ff 0%, #f7fafc 100%);
            border-radius: 12px;
            padding: 25px;
            border: 2px solid #bee3f8;
        }

        .prize-settings h3 {
            color: #2b6cb0;
            margin-bottom: 20px;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .prize-settings h3::before {
            content: "üéÅ";
            font-size: 1.2em;
        }

        .prize-group {
            margin-bottom: 25px;
            padding: 15px;
            background: linear-gradient(135deg, #ffffff 0%, #f7fafc 100%);
            border-radius: 10px;
            border: 2px solid #bee3f8;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .prize-group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .prize-group-title {
            font-weight: bold;
            color: #2b6cb0;
            font-size: 1.2em;
            background: linear-gradient(135deg, #2b6cb0 0%, #3182ce 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .add-prize-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .add-prize-btn:hover {
            background: #45a049;
        }

        .prize-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 8px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .prize-label {
            width: 80px;
            font-weight: bold;
            color: #2d3748;
            font-size: 0.9em;
        }

        .remove-prize-btn {
            background: #f56565;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.8em;
            margin-left: 10px;
        }

        .remove-prize-btn:hover {
            background: #e53e3e;
        }

        .prize-input {
            flex: 1;
            margin: 0 10px;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
        }

        .prize-count {
            width: 80px;
            margin: 0 5px;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            text-align: center;
        }

        .save-settings-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            margin-top: 15px;
            transition: all 0.3s ease;
            box-shadow: 0 3px 12px rgba(76, 175, 80, 0.3);
            font-weight: 600;
        }

        .save-settings-btn:hover {
            background: linear-gradient(135deg, #45a049 0%, #3d8b40 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 16px rgba(76, 175, 80, 0.4);
        }

        .save-settings-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
            opacity: 0.7;
        }

        .save-settings-btn:disabled:hover {
            background: #6c757d;
            transform: none;
        }

        .clear-history-btn {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 20px 0;
            transition: all 0.3s ease;
            box-shadow: 0 3px 12px rgba(245, 101, 101, 0.3);
            font-weight: 600;
        }

        .clear-history-btn:hover {
            background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
            transform: translateY(-2px);
            box-shadow: 0 5px 16px rgba(245, 101, 101, 0.4);
        }

        .remaining-count-display {
            font-size: 0.9em;
            color: #666;
            margin-left: 5px;
        }

        .result-win {
            background: #c6f6d5;
            color: #22543d;
            font-weight: bold;
            text-align: center;
        }

        .result-miss {
            background: #fed7d7;
            color: #742a2a;
            text-align: center;
        }

        .reset-btn {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .reset-btn:hover {
            transform: translateY(-2px);
        }

        .instruction {
            text-align: center;
            color: #666;
            font-size: 1.2em;
            margin-bottom: 20px;
            text-shadow: none;
        }

        .confirm-container {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .confirm-kuji {
            max-width: 350px;
            height: auto;
            margin: 20px 0;
            animation: zoomIn 0.5s ease-out;
        }

        @keyframes zoomIn {
            from {
                transform: scale(0.1);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .confirm-text {
            color: #333;
            font-size: 1.5em;
            margin: 20px 0;
        }

        .confirm-buttons {
            margin-top: 30px;
        }

        .confirm-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 0 10px;
        }

        .cancel-btn {
            background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%);
        }

        .confirm-btn:hover {
            transform: translateY(-2px);
        }

        .code-container {
            display: block;
            text-align: center;
            padding: 40px;
            position: relative;
            z-index: 10;
            border-radius: 15px;
        }

        .code-title {
            color: #333;
            font-size: 1.8em;
            margin-bottom: 30px;
        }

        .code-input-group {
            margin: 20px 0;
        }

        .code-input {
            padding: 15px 20px;
            font-size: 1.2em;
            border: 2px solid #ddd;
            border-radius: 10px;
            width: 300px;
            max-width: 80%;
            text-align: center;
            transition: border-color 0.3s ease;
        }

        .code-input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .code-submit-btn {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .code-submit-btn:hover {
            transform: translateY(-2px);
        }

        .code-submit-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .effort-ticket-section {
            margin-top: 30px;
            padding-top: 20px;
        }

        .section-divider {
            color: #666;
            font-size: 1.1em;
            margin-bottom: 20px;
            position: relative;
        }

        .section-divider::before,
        .section-divider::after {
            content: '';
            position: absolute;
            top: 50%;
            width: 30%;
            height: 1px;
            background: #ddd;
        }

        .section-divider::before {
            left: 0;
        }

        .section-divider::after {
            right: 0;
        }

        .effort-ticket-btn {
            background: linear-gradient(135deg, #9333ea 0%, #7c3aed 100%);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }

        .effort-ticket-btn:hover {
            background: linear-gradient(135deg, #7c3aed 0%, #6d28d9 100%);
            transform: translateY(-2px);
        }

        .back-btn {
            background: linear-gradient(135deg, #6b7280 0%, #4b5563 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1em;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 20px;
        }

        .back-btn:hover {
            background: linear-gradient(135deg, #4b5563 0%, #374151 100%);
            transform: translateY(-2px);
        }

        .participant-info {
            background: #f0f0f0;
            padding: 10px 20px;
            border-radius: 10px;
            margin: 10px 0;
            color: #666;
            font-size: 1.1em;
        }

        .drumroll-container {
            display: none;
            text-align: center;
            padding: 40px;
        }

        .drumroll-text {
            color: #333;
            font-size: 2em;
            margin-bottom: 30px;
            animation: drumroll-pulse 0.5s infinite;
        }

        @keyframes drumroll-pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }



        .countdown {
            font-size: 6em;
            font-weight: bold;
            margin: 30px 0;
            color: white;
            animation: countdown-bounce 1s ease-in-out;
        }

        .countdown-3 {
            background: #ff1744;
            color: white;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px auto;
        }

        .countdown-2 {
            background: #ffd700;
            color: white;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px auto;
        }

        .countdown-1 {
            background: #00ff00;
            color: white;
            width: 200px;
            height: 200px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 30px auto;
            animation: countdown-bounce 1s ease-in-out, final-pulse 1s ease-in-out;
        }

        @keyframes countdown-bounce {
            0% { 
                transform: scale(0.1); 
                opacity: 0; 
            }
            50% { 
                transform: scale(1.3); 
                opacity: 1; 
            }
            100% { 
                transform: scale(1); 
                opacity: 1; 
            }
        }

        @keyframes final-pulse {
            0%, 100% { 
                transform: scale(1); 
            }
            50% { 
                transform: scale(1.1); 
            }
        }

        @keyframes number-dance {
            0% { 
                transform: scale(1) translateY(0) rotate(0deg);
            }
            15% { 
                transform: scale(1.2) translateY(-10px) rotate(5deg);
            }
            30% { 
                transform: scale(0.9) translateY(5px) rotate(-3deg);
            }
            45% { 
                transform: scale(1.1) translateY(-15px) rotate(8deg);
            }
            60% { 
                transform: scale(0.95) translateY(3px) rotate(-5deg);
            }
            75% { 
                transform: scale(1.15) translateY(-8px) rotate(10deg);
            }
            90% { 
                transform: scale(1.05) translateY(2px) rotate(-2deg);
            }
            100% { 
                transform: scale(1) translateY(0) rotate(0deg);
            }
        }

        @media (max-width: 768px) {
            .kuji-item img {
                max-width: 110px;
            }


        }

            .title-content {
                flex-direction: column;
                gap: 15px;
                align-items: center;
            }

            .title-main {
                max-width: 280px;
                width: 280px;
            }

            .kujibox {
                max-width: 150px;
                width: 150px;
            }

            .date-display {
                font-size: 1.1em;
            }

            .confirm-kuji {
                max-width: 300px;
            }

            .confirm-btn {
                padding: 12px 25px;
                font-size: 1.1em;
                margin: 5px;
            }

            .drumroll-text {
                font-size: 1.5em;
            }

            .countdown {
                font-size: 3em;
            }

            .countdown-3, .countdown-2, .countdown-1 {
                width: 150px;
                height: 150px;
                font-size: 3em;
            }

            .code-title {
                font-size: 1.5em;
            }

            .code-input {
                width: 250px;
                font-size: 1.1em;
            }

            #participant-class {
                width: 270px !important;
                max-width: 90% !important;
            }

            #participant-code {
                width: 270px !important;
                max-width: 90% !important;
            }

            .code-submit-btn {
                padding: 12px 25px;
                font-size: 1.1em;
            }





            .draw-counter {
                padding: 15px;
                font-size: 1.2em;
            }

            .count-numbers {
                font-size: 1.5em;
            }

            .admin-content {
                width: 95%;
                padding: 20px;
                max-height: 85%;
            }

            .admin-title {
                font-size: 1.4em;
            }

            .admin-table {
                font-size: 0.9em;
            }

            .admin-table th,
            .admin-table td {
                padding: 8px;
            }

            .result-text {
                font-size: 2em;
            }

        .probability-settings {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #f0fff4 0%, #f7fafc 100%);
            border-radius: 12px;
            border: 2px solid #9ae6b4;
        }

        .probability-settings h3 {
            margin-top: 0;
            color: #2f855a;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .probability-settings h3::before {
            content: "üéØ";
            font-size: 1.2em;
        }

        .probability-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .probability-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px;
            background: linear-gradient(135deg, #ffffff 0%, #f0fff4 100%);
            border-radius: 8px;
            border: 2px solid #9ae6b4;
            box-shadow: 0 2px 6px rgba(0,0,0,0.08);
        }

        .probability-item label {
            font-weight: bold;
            min-width: 60px;
        }

        .probability-item input {
            width: 80px;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            text-align: center;
        }

        .probability-item.out-of-stock {
            background-color: #f5f5f5;
            opacity: 0.7;
        }

        .probability-item.out-of-stock label {
            color: #888;
        }

        .probability-item.out-of-stock input {
            background-color: #f0f0f0;
            color: #666;
        }

        .probability-item.out-of-stock::after {
            content: ' (Âú®Â∫´Âàá„Çå)';
            color: #d32f2f;
            font-size: 0.9em;
            margin-left: 5px;
        }

        .probability-total {
            text-align: center;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #ffffff 0%, #e6fffa 100%);
            border-radius: 10px;
            border: 2px solid #38b2ac;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
        }

        .probability-total #probability-total-value {
            font-size: 24px;
            margin: 0 5px;
        }

        .prize-item.out-of-stock {
            background-color: #ffe6e6;
            border: 1px solid #ff9999;
        }

        .prize-item.out-of-stock .prize-count {
            color: #d32f2f;
            font-weight: bold;
        }

        .prize-item.out-of-stock .prize-input {
            background-color: #fff5f5;
        }

        @media (max-width: 768px) {
            .probability-grid {
                grid-template-columns: 1fr;
            }
        }

        .class-restrictions-settings {
            margin-top: 30px;
            padding: 25px;
            background: linear-gradient(135deg, #fffbf0 0%, #f7fafc 100%);
            border-radius: 12px;
            border: 2px solid #fbd38d;
        }

        .class-restrictions-settings h3 {
            margin-top: 0;
            color: #c05621;
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .class-restrictions-settings h3::before {
            content: "üë•";
            font-size: 1.2em;
        }

        .class-setting-item {
            margin-bottom: 20px;
            padding: 18px;
            background: linear-gradient(135deg, #ffffff 0%, #fffbf0 100%);
            border-radius: 10px;
            border: 2px solid #fbd38d;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .class-setting-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid #eee;
        }

        .class-name {
            font-weight: bold;
            font-size: 1.1em;
            color: #c05621;
            min-width: 120px;
            padding: 5px 10px;
            border-radius: 6px;
            background-color: rgba(251, 211, 141, 0.2);
            border: 1px solid rgba(251, 211, 141, 0.5);
        }

        .setting-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 10px;
        }

        .prize-levels-setting {
            padding: 12px;
            background: linear-gradient(135deg, #fef5e7 0%, #ffffff 100%);
            border-radius: 8px;
            border: 1px solid #fed7aa;
        }

        .draw-limit-setting {
            padding: 12px;
            background: linear-gradient(135deg, #fff7ed 0%, #ffffff 100%);
            border-radius: 8px;
            border: 1px solid #fb923c;
        }

        .setting-label {
            font-weight: bold;
            margin-bottom: 8px;
            color: #4a5568;
            font-size: 0.95em;
        }

        .prize-checkboxes {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
        }

        .prize-checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9em;
        }

        .prize-checkbox-item input[type="checkbox"] {
            margin: 0;
        }

        .draw-limit-input {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .draw-limit-input input[type="number"] {
            width: 80px;
            padding: 8px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            text-align: center;
        }

        .interval-setting {
            margin-top: 10px;
        }

        .interval-input {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 5px;
        }

        .interval-input input[type="number"] {
            width: 60px;
            padding: 6px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            text-align: center;
        }

        @media (max-width: 768px) {
            .setting-grid {
                grid-template-columns: 1fr;
            }
            
            .prize-checkboxes {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ÊôØÂìÅÁîªÂÉèÔºàË£ÖÈ£æÔºâ -->
        <div class="keihin-decoration keihin-1">
            <img src="keihin1.jpg" alt="ÊôØÂìÅ1">
        </div>
        <div class="keihin-decoration keihin-2">
            <img src="keihin2.jpg" alt="ÊôØÂìÅ2">
        </div>
        <div class="keihin-decoration keihin-3">
            <img src="keihin3.jpg" alt="ÊôØÂìÅ3">
        </div>
        <div class="keihin-decoration keihin-4">
            <img src="keihin4.jpg" alt="ÊôØÂìÅ4">
        </div>
        <div class="keihin-decoration keihin-5">
            <img src="keihin5.jpg" alt="ÊôØÂìÅ5">
        </div>
        <div class="keihin-decoration keihin-6">
            <img src="keihin6.png" alt="ÊôØÂìÅ6">
        </div>

        
        <div class="title">
            <img src="rogo.png" alt="„É≠„Ç¥" class="logo">
            <div class="title-content">
                <img src="title.png" alt="„Åè„ÅòÂºï„ÅçWEB„Çµ„Éº„Éì„Çπ" class="title-main">
                <img src="kujibox.png" alt="„Åè„ÅòÁÆ±" class="kujibox">
            </div>
        </div>
        <div class="date-display" id="date-display"></div>
        
        <div class="winner-count-title">ÁèæÂú®„ÅÆÂΩìÈÅ∏ËÄÖÊï∞: <span id="total-winners">0</span>‰∫∫</div>
        
        <div id="code-screen" class="code-container">
            <div class="code-title">„ÇØ„É©„Çπ„Éª„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
            <div class="draw-counter" id="draw-counter" style="display: none;"></div>
            <div class="code-input-group">
                <select id="participant-class" class="code-input" style="width: 320px; max-width: 85%;">
                    <option value="">„ÇØ„É©„Çπ„ÇíÈÅ∏Êäû</option>
                    <option value="Kid's„Çº„Éü">Kid's„Çº„Éü</option>
                    <option value="„Éë„Ç∫„É´ÈÅìÂ†¥">„Éë„Ç∫„É´ÈÅìÂ†¥</option>
                    <option value="3J">3J</option>
                    <option value="4S">4S</option>
                    <option value="5S">5S</option>
                    <option value="6S">6S</option>
                    <option value="4H">4H</option>
                    <option value="5H">5H</option>
                    <option value="6H">6H</option>
                    <option value="1A">1A</option>
                    <option value="2A">2A</option>
                    <option value="3A">3A</option>
                </select>
            </div>
            <div class="code-input-group">
                <select id="participant-code" class="code-input" style="width: 320px; max-width: 85%;">
                    <option value="">Áï™Âè∑„ÇíÈÅ∏Êäû</option>
                </select>
            </div>
            <button class="code-submit-btn" onclick="submitCode()">„Åè„Åò„Çí„Å≤„Åè</button>
            
            <div class="effort-ticket-section">
                <div class="section-divider">„Åæ„Åü„ÅØ</div>
                <button class="effort-ticket-btn" onclick="showEffortTicketScreen()">Âä™ÂäõÂà∏„Çí5Êûö‰Ωø„Å£„Å¶„Åè„Åò„Çí„Å≤„Åè</button>
            </div>
        </div>

        <div id="effort-ticket-screen" class="code-container" style="display: none;">
            <div class="code-title">ÁâπÂà•„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
            <div class="code-input-group">
                <input type="text" id="effort-ticket-code" class="code-input" placeholder="ÁâπÂà•„Ç≥„Éº„Éâ„ÇíÂÖ•Âäõ" maxlength="20">
            </div>
            <button class="code-submit-btn" onclick="submitEffortTicketCode()">„Åè„Åò„Çí„Å≤„Åè</button>
            <div id="effort-ticket-error" class="password-error" style="display: none;">„Ç≥„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô</div>
            <button class="back-btn" onclick="backToMainScreen()">Êàª„Çã</button>
        </div>

        <div id="kuji-screen" style="display: none;">
            <div class="participant-info" id="participant-info"></div>
            <div class="instruction">„ÅäÂ•Ω„Åç„Å™„Åè„Åò„ÇíÈÅ∏„Çì„Åß„Åè„Å†„Åï„ÅÑÔºÅ</div>
            <div class="kuji-container" id="kuji-container">
                <!-- „Åè„Åò„ÅåJavaScript„ÅßÁîüÊàê„Åï„Çå„Åæ„Åô -->
            </div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="back-btn" onclick="backFromKujiScreen()">Êàª„Çã</button>
            </div>
        </div>

        <div id="confirm-screen" class="confirm-container">
            <div class="confirm-text">„Åì„ÅÆ„Åè„Åò„Åß„ÅÑ„ÅÑ„Åß„Åô„ÅãÔºü</div>
            <img id="confirm-kuji" class="confirm-kuji" src="kuji.png" alt="ÈÅ∏Êäû„Åï„Çå„Åü„Åè„Åò">
            <div class="confirm-buttons">
                <button class="confirm-btn" onclick="confirmKuji()">„ÅØ„ÅÑ</button>
                <button class="confirm-btn cancel-btn" onclick="cancelKuji()">„ÅÑ„ÅÑ„Åà</button>
            </div>
        </div>

        <div id="drumroll-screen" class="drumroll-container">
            <div class="drumroll-text">ÁµêÊûúÁô∫Ë°®„Åæ„Åß‚Ä¶</div>
            <div id="countdown-display" class="countdown"></div>
        </div>

        <div id="result-screen" class="result-container">
            <div class="result-text" id="result-text"></div>
            <img id="result-image" class="result-image" src="" alt="ÁµêÊûú">
            <div class="winner-info" id="winner-info" style="display: none;"></div>
            <br>
            <button class="reset-btn" onclick="resetGame()">„ÇÇ„Å©„Çã</button>
        </div>
    </div>

    <!-- Ê≠ØËªä„Ç¢„Ç§„Ç≥„É≥ -->
    <div class="settings-icon" onclick="openAdminPanel()">
        <svg viewBox="0 0 24 24">
            <path d="M12,15.5A3.5,3.5 0 0,1 8.5,12A3.5,3.5 0 0,1 12,8.5A3.5,3.5 0 0,1 15.5,12A3.5,3.5 0 0,1 12,15.5M19.43,12.97C19.47,12.65 19.5,12.33 19.5,12C19.5,11.67 19.47,11.34 19.43,11L21.54,9.37C21.73,9.22 21.78,8.95 21.66,8.73L19.66,5.27C19.54,5.05 19.27,4.96 19.05,5.05L16.56,6.05C16.04,5.66 15.5,5.32 14.87,5.07L14.5,2.42C14.46,2.18 14.25,2 14,2H10C9.75,2 9.54,2.18 9.5,2.42L9.13,5.07C8.5,5.32 7.96,5.66 7.44,6.05L4.95,5.05C4.73,4.96 4.46,5.05 4.34,5.27L2.34,8.73C2.22,8.95 2.27,9.22 2.46,9.37L4.57,11C4.53,11.34 4.5,11.67 4.5,12C4.5,12.33 4.53,12.65 4.57,12.97L2.46,14.63C2.27,14.78 2.22,15.05 2.34,15.27L4.34,18.73C4.46,18.95 4.73,19.03 4.95,18.95L7.44,17.94C7.96,18.34 8.5,18.68 9.13,18.93L9.5,21.58C9.54,21.82 9.75,22 10,22H14C14.25,22 14.46,21.82 14.5,21.58L14.87,18.93C15.5,18.68 16.04,18.34 16.56,17.94L19.05,18.95C19.27,19.03 19.54,18.95 19.66,18.73L21.66,15.27C21.78,15.05 21.73,14.78 21.54,14.63L19.43,12.97Z"/>
        </svg>
    </div>

    <!-- „Éë„Çπ„ÉØ„Éº„ÉâÂÖ•ÂäõÁîªÈù¢ -->
    <div class="admin-panel" id="password-panel">
        <div class="admin-content">
            <div class="admin-header">
                <div class="admin-title">ÁÆ°ÁêÜÁîªÈù¢„É≠„Ç∞„Ç§„É≥</div>
                <button class="close-btn" onclick="closePasswordPanel()">Èñâ„Åò„Çã</button>
            </div>
            <div class="password-container">
                <div class="password-title">„Éë„Çπ„ÉØ„Éº„Éâ„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ</div>
                <input type="password" id="admin-password" class="password-input" placeholder="„Éë„Çπ„ÉØ„Éº„Éâ" maxlength="10">
                <button class="password-submit-btn" onclick="checkPassword()">„É≠„Ç∞„Ç§„É≥</button>
                <div id="password-error" class="password-error" style="display: none;">„Éë„Çπ„ÉØ„Éº„Éâ„ÅåÈñìÈÅï„Å£„Å¶„ÅÑ„Åæ„Åô</div>
            </div>
        </div>
    </div>

    <!-- ÁÆ°ÁêÜÁîªÈù¢ -->
    <div class="admin-panel" id="admin-panel">
        <div class="admin-content">
            <div class="admin-header">
                <div class="admin-title">ÁÆ°ÁêÜÁîªÈù¢</div>
                <button class="close-btn" onclick="closeAdminPanel()">Èñâ„Åò„Çã</button>
            </div>
            <div id="admin-data">
                <!-- ÁÆ°ÁêÜ„Éá„Éº„Çø„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Åæ„Åô -->
            </div>
            <button class="clear-history-btn" onclick="clearHistoryData()">ÊäΩÈÅ∏Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢</button>
            
            <div class="prize-settings">
                <h3>ÊôØÂìÅË®≠ÂÆö</h3>
                <div id="prize-groups-container">
                    <!-- ÊôØÂìÅ„Ç∞„É´„Éº„Éó„ÅåJavaScript„ÅßÁîüÊàê„Åï„Çå„Åæ„Åô -->
                </div>
                <button class="save-settings-btn" onclick="savePrizeSettings()">ÊôØÂìÅË®≠ÂÆö„Çí‰øùÂ≠ò</button>
            </div>

            <div class="probability-settings">
                <h3>Á¢∫ÁéáË®≠ÂÆö</h3>
                <div class="probability-grid">
                    <div class="probability-item">
                        <label>ÁâπÂà•Ë≥û:</label>
                        <input type="number" id="prob-special" min="0" max="100" value="1">
                        <span>%</span>
                    </div>
                    <div class="probability-item">
                        <label>1Á≠â:</label>
                        <input type="number" id="prob-1tou" min="0" max="100" value="1">
                        <span>%</span>
                    </div>
                    <div class="probability-item">
                        <label>2Á≠â:</label>
                        <input type="number" id="prob-2tou" min="0" max="100" value="3">
                        <span>%</span>
                    </div>
                    <div class="probability-item">
                        <label>3Á≠â:</label>
                        <input type="number" id="prob-3tou" min="0" max="100" value="5">
                        <span>%</span>
                    </div>
                    <div class="probability-item">
                        <label>4Á≠â:</label>
                        <input type="number" id="prob-4tou" min="0" max="100" value="10">
                        <span>%</span>
                    </div>
                    <div class="probability-item">
                        <label>5Á≠â:</label>
                        <input type="number" id="prob-5tou" min="0" max="100" value="20">
                        <span>%</span>
                    </div>
                    <div class="probability-item">
                        <label>„Éè„Ç∫„É¨:</label>
                        <input type="number" id="prob-hazure" min="0" max="100" value="60">
                        <span>%</span>
                    </div>
                </div>
                <div class="probability-total">
                    <span>ÂêàË®àÁ¢∫Áéá: </span>
                    <span id="probability-total-value">100</span>
                    <span>%</span>
                </div>
                <button class="save-settings-btn" onclick="saveProbabilitySettingsUI()">Á¢∫ÁéáË®≠ÂÆö„Çí‰øùÂ≠ò</button>
            </div>

            <div class="class-restrictions-settings">
                <h3>„ÇØ„É©„ÇπÂà•Ë®≠ÂÆö</h3>
                <div id="class-settings-container">
                    <!-- „ÇØ„É©„ÇπÂà•Ë®≠ÂÆö„ÅåJavaScript„ÅßÁîüÊàê„Åï„Çå„Åæ„Åô -->
                </div>
                <button class="save-settings-btn" onclick="saveClassSettings()">„ÇØ„É©„ÇπÂà•Ë®≠ÂÆö„Çí‰øùÂ≠ò</button>
            </div>
            

        </div>
    </div>

    <script>
        const results = [
            { image: 'special.jpg', text: 'ÁâπÂà•Ë≥ûÂΩìÈÅ∏' },
            { image: '1tou.jpg', text: '1Á≠âÂΩìÈÅ∏' },
            { image: '2tou.jpg', text: '2Á≠âÂΩìÈÅ∏' },
            { image: '3tou.jpg', text: '3Á≠âÂΩìÈÅ∏' },
            { image: '4tou.jpg', text: '4Á≠âÂΩìÈÅ∏' },
            { image: '5tou.jpg', text: '5Á≠âÂΩìÈÅ∏' },
            { image: 'hazure.jpg', text: 'ÊÆãÂøµÔºÅ„Éè„Ç∫„É¨„Åß„Åô...' }
        ];

        // Á¢∫Áéá„Å´Âü∫„Å•„ÅÑ„Å¶ÊäΩÈÅ∏ÁµêÊûú„ÇíÊ±∫ÂÆö
        function drawByProbability(allowedTypes = null) {
            // ÊäΩÈÅ∏Ââç„Å´Ëá™Âãï„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Çí‰ΩúÊàê
            backupCurrentData();
            console.log('ÊäΩÈÅ∏Ââç„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„ÉóÂÆå‰∫Ü');
            
            // Ë®≠ÂÆö„Åï„Çå„ÅüÁ¢∫Áéá„ÇíÂèñÂæó
            const probabilitySettings = getProbabilitySettings();
            
            console.log('=== ÊäΩÈÅ∏ÈñãÂßã ===');
            console.log('Ë®≠ÂÆö„Åï„Çå„ÅüÁ¢∫Áéá:', probabilitySettings);
            console.log('Ë®±ÂèØ„Åï„Çå„ÅüÁ®ÆÈ°û:', allowedTypes);
            
            // ÂêÑÁµêÊûú„ÅÆÁ¢∫Áéá„ÇíÂÆöÁæ©
            const allProbabilities = [
                { image: 'special.jpg', text: 'ÁâπÂà•Ë≥ûÂΩìÈÅ∏', probability: probabilitySettings.special, key: 'special' },
                { image: '1tou.jpg', text: '1Á≠âÂΩìÈÅ∏', probability: probabilitySettings['1tou'], key: '1tou' },
                { image: '2tou.jpg', text: '2Á≠âÂΩìÈÅ∏', probability: probabilitySettings['2tou'], key: '2tou' },
                { image: '3tou.jpg', text: '3Á≠âÂΩìÈÅ∏', probability: probabilitySettings['3tou'], key: '3tou' },
                { image: '4tou.jpg', text: '4Á≠âÂΩìÈÅ∏', probability: probabilitySettings['4tou'], key: '4tou' },
                { image: '5tou.jpg', text: '5Á≠âÂΩìÈÅ∏', probability: probabilitySettings['5tou'], key: '5tou' },
                { image: 'hazure.jpg', text: 'ÊÆãÂøµÔºÅ„Éè„Ç∫„É¨„Åß„Åô...', probability: probabilitySettings.hazure, key: 'hazure' }
            ];
            
            // ÊôØÂìÅË®≠ÂÆö„ÇíÂèñÂæó
            const prizeSettings = getPrizeSettings();
            
            // Âà©Áî®ÂèØËÉΩ„Å™ÁµêÊûú„ÅÆ„Åø„Çí„Éï„Ç£„É´„Çø„É™„É≥„Ç∞
            const availableProbabilities = allProbabilities.filter(p => {
                // Á¢∫Áéá„Åå0%„ÅÆÂ†¥Âêà„ÅØÈô§Â§ñ
                if (p.probability <= 0) {
                    console.log(`Èô§Â§ñÔºàÁ¢∫Áéá0%Ôºâ: ${p.image}`);
                    return false;
                }
                
                // Ë®±ÂèØ„Åï„Çå„ÅüÁ®ÆÈ°û„ÅÆ„ÉÅ„Çß„ÉÉ„ÇØÔºàÂà∂Èôê„ÇØ„É©„ÇπÁî®Ôºâ
                if (allowedTypes && !allowedTypes.includes(p.image)) {
                    console.log(`Èô§Â§ñÔºàË®±ÂèØ„Åï„Çå„Å¶„ÅÑ„Å™„ÅÑÔºâ: ${p.image}`);
                    return false;
                }
                
                // „Éè„Ç∫„É¨„ÅØÂ∏∏„Å´Âà©Áî®ÂèØËÉΩ
                if (p.image === 'hazure.jpg') {
                    console.log(`Âà©Áî®ÂèØËÉΩÔºà„Éè„Ç∫„É¨Ôºâ: ${p.image} - Á¢∫Áéá: ${p.probability}%`);
                    return true;
                }
                
                // ÊôØÂìÅ„ÅÆÂú®Â∫´„ÉÅ„Çß„ÉÉ„ÇØ
                const prizeItems = prizeSettings[p.key] || [];
                const hasStock = prizeItems.some(item => item.remainingCount > 0);
                
                if (hasStock) {
                    console.log(`Âà©Áî®ÂèØËÉΩÔºàÂú®Â∫´„ÅÇ„ÇäÔºâ: ${p.image} - Á¢∫Áéá: ${p.probability}%`);
                } else {
                    console.log(`Èô§Â§ñÔºàÂú®Â∫´„Å™„ÅóÔºâ: ${p.image}`);
                }
                
                return hasStock;
            });
            
            console.log('Âà©Áî®ÂèØËÉΩ„Å™ÁµêÊûúÊï∞:', availableProbabilities.length);
            
            // Âà©Áî®ÂèØËÉΩ„Å™ÁµêÊûú„Åå„Å™„ÅÑÂ†¥Âêà„ÅÆÂá¶ÁêÜ
            if (availableProbabilities.length === 0) {
                console.error('Ëá¥ÂëΩÁöÑ„Ç®„É©„Éº: Âà©Áî®ÂèØËÉΩ„Å™ÁµêÊûú„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                // „Éè„Ç∫„É¨„ÅÆÁ¢∫Áéá„Åå0%„Åß„Å™„Åë„Çå„Å∞„Éè„Ç∫„É¨„ÇíËøî„Åô
                if (probabilitySettings.hazure > 0) {
                    console.log('„Éè„Ç∫„É¨„ÅÆÁ¢∫Áéá„Åå0%‰ª•‰∏ä„ÅÆ„Åü„ÇÅ„ÄÅ„Éè„Ç∫„É¨„ÇíËøî„Åó„Åæ„Åô');
                    return { image: 'hazure.jpg', text: 'ÊÆãÂøµÔºÅ„Éè„Ç∫„É¨„Åß„Åô...' };
                } else {
                    console.error('„Éè„Ç∫„É¨„ÅÆÁ¢∫Áéá„ÇÇ0%„Åß„Åô„ÄÇ„Ç∑„Çπ„ÉÜ„É†„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ');
                    return { image: 'hazure.jpg', text: '„Ç∑„Çπ„ÉÜ„É†„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü' };
                }
            }
            
            // Á¢∫Áéá„ÅÆÂêàË®à„ÇíË®àÁÆó
            const totalProbability = availableProbabilities.reduce((sum, p) => sum + p.probability, 0);
            console.log('Á¢∫Áéá„ÅÆÂêàË®à:', totalProbability);
            
            if (totalProbability === 0) {
                console.error('Ëá¥ÂëΩÁöÑ„Ç®„É©„Éº: Á¢∫Áéá„ÅÆÂêàË®à„Åå0„Åß„Åô');
                return { image: 'hazure.jpg', text: '„Ç∑„Çπ„ÉÜ„É†„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü' };
            }
            
            // 0„Åã„ÇâÁ¢∫Áéá„ÅÆÂêàË®à„ÅÆÁØÑÂõ≤„Åß„É©„É≥„ÉÄ„É†ÂÄ§„ÇíÁîüÊàê
            const random = Math.random() * totalProbability;
            console.log('ÁîüÊàê„Åï„Çå„Åü„É©„É≥„ÉÄ„É†ÂÄ§:', random);
            
            // Á¥ØÁ©çÁ¢∫Áéá„ÅßÂà§ÂÆö
            let currentThreshold = 0;
            for (const prob of availableProbabilities) {
                currentThreshold += prob.probability;
                const actualPercentage = ((prob.probability / totalProbability) * 100).toFixed(1);
                console.log(`${prob.image}: Ë®≠ÂÆöÁ¢∫Áéá=${prob.probability}% ÂÆüÈöõ„ÅÆÂâ≤Âêà=${actualPercentage}% Á¥ØÁ©çÈñæÂÄ§=${currentThreshold}`);
                
                if (random <= currentThreshold) {
                    console.log(`*** ÈÅ∏Êäû„Åï„Çå„ÅüÁµêÊûú: ${prob.image} ***`);
                    return { image: prob.image, text: prob.text };
                }
            }
            
            // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÔºàÈÄöÂ∏∏„ÅØÂà∞ÈÅî„Åó„Å™„ÅÑÔºâ
            console.error('„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØ‰ΩøÁî® - ÊúÄÂæå„ÅÆÁµêÊûú„ÇíËøî„Åó„Åæ„Åô');
            const fallbackResult = availableProbabilities[availableProbabilities.length - 1];
            console.log('„Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁµêÊûú:', fallbackResult.image);
            return fallbackResult;
        }

                // „ÇØ„É©„ÇπÂà•ÊäΩÈÅ∏ÁµêÊûú„ÇíÊ±∫ÂÆö
        function getResultForParticipant(participantId) {
            // ÁâπÂà•„Ç≥„Éº„Éâ„É¢„Éº„Éâ„ÅÆÂ†¥Âêà„ÅØÂà∂Èôê„Å™„Åó„ÅßÂÖ®„Å¶„ÅÆÁ≠âÁ¥ö„ÅåÂΩìÈÅ∏ÂèØËÉΩ
            if (isEffortTicketMode) {
                return drawByProbability();
            }
            
            const participantClass = getParticipantClass(participantId);
            const classSettings = getClassSettings();
            const classSetting = classSettings[participantClass] || DEFAULT_CLASS_SETTINGS[participantClass];
            
            console.log(`=== ${participantClass}„ÅÆÊäΩÈÅ∏Âá¶ÁêÜ ===`);
            console.log('„ÇØ„É©„ÇπË®≠ÂÆö:', classSetting);
            
            // ÂΩìÈÅ∏ÂõûÊï∞Âà∂Èôê„ÉÅ„Çß„ÉÉ„ÇØ
            const currentWinCount = getParticipantWinCount(participantId);
            const maxWins = classSetting.maxWins || 1;
            
            console.log('ÁèæÂú®„ÅÆÂΩìÈÅ∏ÂõûÊï∞:', currentWinCount);
            console.log('ÊúÄÂ§ßÂΩìÈÅ∏ÂõûÊï∞:', maxWins);
            
            // ÂΩìÈÅ∏ÂõûÊï∞„Åå‰∏äÈôê„Å´ÈÅî„Åó„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØÂøÖ„Åö„Éè„Ç∫„É¨
            if (currentWinCount >= maxWins) {
                console.log('ÂΩìÈÅ∏ÂõûÊï∞‰∏äÈôê„Å´ÈÅî„Åó„Å¶„ÅÑ„Çã„Åü„ÇÅ„ÄÅ„Éè„Ç∫„É¨„ÇíËøî„Åó„Åæ„Åô');
                return { image: 'hazure.jpg', text: 'ÊÆãÂøµÔºÅ„Éè„Ç∫„É¨„Åß„Åô...' };
            }
            
            // „ÇØ„É©„ÇπË®≠ÂÆö„Åã„ÇâÂΩìÈÅ∏ÂèØËÉΩ„Å™Á≠âÁ¥ö„ÇíÂèñÂæó
            const allowedPrizes = classSetting.allowedPrizes || ['hazure'];
            console.log('ÂΩìÈÅ∏ÂèØËÉΩÁ≠âÁ¥ö:', allowedPrizes);
            
            // allowedPrizes„ÇíÁîªÂÉè„Éï„Ç°„Ç§„É´Âêç„Å´Â§âÊèõ
            const allowedTypes = allowedPrizes.map(prize => {
                if (prize === 'hazure') return 'hazure.jpg';
                if (prize === 'special') return 'special.jpg';
                return `${prize}.jpg`;
            });
            
            console.log('Ë®±ÂèØ„Åï„Çå„ÅüÁîªÂÉè„Çø„Ç§„Éó:', allowedTypes);
            
            // Ë®≠ÂÆö„Åï„Çå„ÅüÁ¢∫Áéá„ÅßÊäΩÈÅ∏
            return drawByProbability(allowedTypes);
        }

        let currentParticipant = null;
        let isEffortTicketMode = false;
        const MAX_TOTAL_DRAWS = 5; // ÂÖ®Âì°ÂÖ±ÈÄö„ÅÆÊúÄÂ§ßÊäΩÈÅ∏ÂõûÊï∞
        const STORAGE_KEY = 'kuji_history';
        const PRIZE_SETTINGS_KEY = 'kuji_prize_settings';
        const PROBABILITY_SETTINGS_KEY = 'kuji_probability_settings';
        const CLASS_SETTINGS_KEY = 'kuji_class_settings';
        const SPECIAL_CODE = 'Takoyaki66';

        // ÊôØÂìÅË®≠ÂÆö„ÅÆ„Éá„Éï„Ç©„É´„ÉàÂÄ§
        const DEFAULT_PRIZE_SETTINGS = {
            'special': [
                { name: 'ÁâπÂà•„ÇÆ„Éï„ÉàÂà∏', totalCount: 3, remainingCount: 3 },
                { name: 'ÁâπË£Ω„Ç∞„ÉÉ„Ç∫', totalCount: 2, remainingCount: 2 }
            ],
            '1tou': [
                { name: 'iPad', totalCount: 2, remainingCount: 2 },
                { name: 'Nintendo Switch', totalCount: 2, remainingCount: 2 },
                { name: 'Âõ≥Êõ∏„Ç´„Éº„Éâ1‰∏áÂÜÜ', totalCount: 1, remainingCount: 1 }
            ],
            '2tou': [
                { name: 'Âõ≥Êõ∏„Ç´„Éº„Éâ5ÂçÉÂÜÜ', totalCount: 5, remainingCount: 5 },
                { name: 'AirPods', totalCount: 3, remainingCount: 3 },
                { name: 'Amazon„ÇÆ„Éï„ÉàÂà∏5ÂçÉÂÜÜ', totalCount: 2, remainingCount: 2 }
            ],
            '3tou': [
                { name: 'QUO„Ç´„Éº„Éâ3ÂçÉÂÜÜ', totalCount: 10, remainingCount: 10 },
                { name: 'Âõ≥Êõ∏„Ç´„Éº„Éâ3ÂçÉÂÜÜ', totalCount: 5, remainingCount: 5 }
            ],
            '4tou': [
                { name: 'ÊñáÊàøÂÖ∑„Çª„ÉÉ„Éà', totalCount: 20, remainingCount: 20 },
                { name: 'QUO„Ç´„Éº„Éâ1ÂçÉÂÜÜ', totalCount: 10, remainingCount: 10 }
            ],
            '5tou': [
                { name: '„ÅäËèìÂ≠ê„Çª„ÉÉ„Éà', totalCount: 30, remainingCount: 30 },
                { name: 'ÊñáÊàøÂÖ∑', totalCount: 20, remainingCount: 20 }
            ]
        };

        // Á¢∫ÁéáË®≠ÂÆö„ÅÆ„Éá„Éï„Ç©„É´„ÉàÂÄ§
        const DEFAULT_PROBABILITY_SETTINGS = {
            'special': 1,
            '1tou': 1,
            '2tou': 3,
            '3tou': 5,
            '4tou': 10,
            '5tou': 20,
            'hazure': 60
        };

        // „ÇØ„É©„ÇπÂà•Ë®≠ÂÆö„ÅÆ„Éá„Éï„Ç©„É´„ÉàÂÄ§
        const DEFAULT_CLASS_SETTINGS = {
            "Kid's„Çº„Éü": {
                allowedPrizes: ['4tou', '5tou', 'hazure'],
                maxWins: 3, // ÊúÄÂ§ßÂΩìÈÅ∏ÂõûÊï∞
                drawInterval: 1 // 1Êó•„Å´1Âõû
            },
            "„Éë„Ç∫„É´ÈÅìÂ†¥": {
                allowedPrizes: ['4tou', '5tou', 'hazure'],
                maxWins: 3,
                drawInterval: 1
            },
            "3J": {
                allowedPrizes: ['4tou', '5tou', 'hazure'],
                maxWins: 3,
                drawInterval: 1
            },
            "4S": {
                allowedPrizes: ['special', '1tou', '2tou', '3tou', '4tou', '5tou', 'hazure'],
                maxWins: 1, // Âà∂Èôê„ÇØ„É©„Çπ„ÅØ1Âõû„ÅÆ„ÅøÂΩìÈÅ∏ÂèØËÉΩ
                drawInterval: 5 // 5Êó•„Å´1Âõû
            },
            "5S": {
                allowedPrizes: ['special', '1tou', '2tou', '3tou', '4tou', '5tou', 'hazure'],
                maxWins: 1,
                drawInterval: 5
            },
            "6S": {
                allowedPrizes: ['special', '1tou', '2tou', '3tou', '4tou', '5tou', 'hazure'],
                maxWins: 2, // 6S„ÅØ2Âõû„Åæ„ÅßÂΩìÈÅ∏ÂèØËÉΩ
                drawInterval: 5
            },
            "4H": {
                allowedPrizes: ['special', '1tou', '2tou', '3tou', '4tou', '5tou', 'hazure'],
                maxWins: 1,
                drawInterval: 5
            },
            "5H": {
                allowedPrizes: ['special', '1tou', '2tou', '3tou', '4tou', '5tou', 'hazure'],
                maxWins: 1,
                drawInterval: 5
            },
            "6H": {
                allowedPrizes: ['special', '1tou', '2tou', '3tou', '4tou', '5tou', 'hazure'],
                maxWins: 1,
                drawInterval: 5
            },
            "1A": {
                allowedPrizes: ['special', '1tou', '2tou', '3tou', '4tou', '5tou', 'hazure'],
                maxWins: 1,
                drawInterval: 5
            },
            "2A": {
                allowedPrizes: ['special', '1tou', '2tou', '3tou', '4tou', '5tou', 'hazure'],
                maxWins: 1,
                drawInterval: 5
            },
            "3A": {
                allowedPrizes: ['special', '1tou', '2tou', '3tou', '4tou', '5tou', 'hazure'],
                maxWins: 2, // 3A„ÅØ2Âõû„Åæ„ÅßÂΩìÈÅ∏ÂèØËÉΩ
                drawInterval: 5
            }
        };

        // Ê≥®ÊÑè: CLASS_RESTRICTIONS„ÅØÊñ∞„Åó„ÅÑ„ÇØ„É©„ÇπË®≠ÂÆö„Ç∑„Çπ„ÉÜ„É†„Å´ÁΩÆ„ÅçÊèõ„Åà„Çâ„Çå„Åæ„Åó„Åü
        // ‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅ„Å´ÊÆã„Åó„Å¶„ÅÇ„Çä„Åæ„Åô„Åå„ÄÅÂÆüÈöõ„ÅÆÂà∂Èôê„ÅØDEFAULT_CLASS_SETTINGS„ÅßÁÆ°ÁêÜ„Åï„Çå„Åæ„Åô

        // Â±•Ê≠¥„Éá„Éº„Çø„ÇíÂèñÂæó
        function getHistory() {
            const stored = localStorage.getItem(STORAGE_KEY);
            return stored ? JSON.parse(stored) : {};
        }

        // Â±•Ê≠¥„Éá„Éº„Çø„Çí‰øùÂ≠ò
        function saveHistory(history) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(history));
        }

        // ÊôØÂìÅË®≠ÂÆö„ÇíÂèñÂæó
        function getPrizeSettings() {
            console.log('=== ÊôØÂìÅË®≠ÂÆöÂèñÂæóÂá¶ÁêÜ ===');
            console.log('PRIZE_SETTINGS_KEY:', PRIZE_SETTINGS_KEY);
            const stored = localStorage.getItem(PRIZE_SETTINGS_KEY);
            console.log('localStorage„Åã„ÇâÂèñÂæó„Åó„ÅüÁîü„Éá„Éº„Çø:', stored);
            
            if (stored) {
                try {
                    const result = JSON.parse(stored);
                    console.log('Êó¢Â≠ò„ÅÆÊôØÂìÅË®≠ÂÆö„ÇíÂèñÂæó:', result);
                    console.log('=== ÊôØÂìÅË®≠ÂÆöÂèñÂæóÂÆå‰∫ÜÔºàÊó¢Â≠ò„Éá„Éº„ÇøÔºâ ===');
                    return result;
                } catch (error) {
                    console.error('JSONËß£Êûê„Ç®„É©„Éº:', error);
                    console.log('„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆö„Çí‰ΩøÁî®„Åó„Åæ„Åô');
                }
            } else {
                console.log('localStorage„Å´Ë®≠ÂÆö„Åå„Å™„ÅÑ„Åü„ÇÅ„ÄÅ„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆö„ÇíÂàùÊúüÂåñ');
            }
            
            // „Éá„Éï„Ç©„É´„ÉàË®≠ÂÆö„Çí‰∏ÄÂ∫¶„Å†„Åë‰øùÂ≠ò
            const defaultSettings = JSON.parse(JSON.stringify(DEFAULT_PRIZE_SETTINGS));
            localStorage.setItem(PRIZE_SETTINGS_KEY, JSON.stringify(defaultSettings));
            console.log('„Éá„Éï„Ç©„É´„ÉàË®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü:', defaultSettings);
            console.log('=== ÊôØÂìÅË®≠ÂÆöÂèñÂæóÂÆå‰∫ÜÔºà„Éá„Éï„Ç©„É´„ÉàÂàùÊúüÂåñÔºâ ===');
            return defaultSettings;
        }

        // Á∑äÊÄ•Áî®ÔºöÂº∑Âà∂ÁöÑ„Å´Âú®Â∫´„Çí1ÂÄãÊ∏õ„Çâ„ÅôÈñ¢Êï∞Ôºà„Éá„Éê„ÉÉ„Ç∞Áî®Ôºâ
        function forceReduceStock(prizeKey, prizeName) {
            console.log('*** Á∑äÊÄ•Âú®Â∫´Ê∏õÂ∞ëÂá¶ÁêÜ ***');
            const settings = getPrizeSettings();
            const items = settings[prizeKey] || [];
            const targetIndex = items.findIndex(item => item.name === prizeName && item.remainingCount > 0);
            
            if (targetIndex !== -1) {
                const beforeCount = settings[prizeKey][targetIndex].remainingCount;
                settings[prizeKey][targetIndex].remainingCount--;
                const afterCount = settings[prizeKey][targetIndex].remainingCount;
                
                const saveSuccess = savePrizeSettingsData(settings);
                
                if (saveSuccess) {
                    console.log(`${prizeName}: ${beforeCount} ‚Üí ${afterCount}`);
                    console.log('Á∑äÊÄ•‰øùÂ≠òÂÆå‰∫Ü');
                    
                    // ÁÆ°ÁêÜÁîªÈù¢Êõ¥Êñ∞
                    forceRefreshAdmin();
                    return true;
                } else {
                    console.error('Á∑äÊÄ•‰øùÂ≠òÂ§±Êïó');
                    return false;
                }
            } else {
                console.log('Ë©≤ÂΩì„Åô„ÇãÊôØÂìÅ„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return false;
            }
        }

        // Á∑äÊÄ•Áî®ÔºöÁèæÂú®„ÅÆ„Éá„Éº„Çø„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åô„Çã
        function backupCurrentData() {
            const currentData = localStorage.getItem(PRIZE_SETTINGS_KEY);
            if (currentData) {
                localStorage.setItem(PRIZE_SETTINGS_KEY + '_backup', currentData);
                console.log('„Éá„Éº„Çø„Çí„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åó„Åæ„Åó„Åü');
                return true;
            }
            return false;
        }

        // Á∑äÊÄ•Áî®Ôºö„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åã„Çâ„Éá„Éº„Çø„ÇíÂæ©Êóß„Åô„Çã
        function restoreFromBackup() {
            const backupData = localStorage.getItem(PRIZE_SETTINGS_KEY + '_backup');
            if (backupData) {
                localStorage.setItem(PRIZE_SETTINGS_KEY, backupData);
                console.log('„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Åã„Çâ„Éá„Éº„Çø„ÇíÂæ©Êóß„Åó„Åæ„Åó„Åü');
                forceRefreshAdmin();
                return true;
            } else {
                console.log('„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return false;
            }
        }

        // Á∑äÊÄ•Áî®ÔºöÁèæÂú®„ÅÆ„Éá„Éº„ÇøÁä∂Ê≥Å„ÇíÁ¢∫Ë™ç„Åô„Çã
        function checkDataStatus() {
            console.log('=== „Éá„Éº„ÇøÁä∂Ê≥ÅÁ¢∫Ë™ç ===');
            const current = localStorage.getItem(PRIZE_SETTINGS_KEY);
            const backup = localStorage.getItem(PRIZE_SETTINGS_KEY + '_backup');
            
            console.log('ÁèæÂú®„ÅÆ„Éá„Éº„Çø:', current);
            console.log('„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Éá„Éº„Çø:', backup);
            
            if (current) {
                try {
                    const parsed = JSON.parse(current);
                    console.log('ÁèæÂú®„ÅÆ„Éá„Éº„ÇøÔºàËß£ÊûêÊ∏à„ÅøÔºâ:', parsed);
                    
                    // ÂêÑÊôØÂìÅ„ÅÆÂú®Â∫´ÊÉÖÂ†±„ÇíË©≥Á¥∞Ë°®Á§∫
                    Object.keys(parsed).forEach(key => {
                        console.log(`${key}:`);
                        const items = parsed[key] || [];
                        items.forEach((item, index) => {
                            console.log(`  ${index}: ${item.name} - ÊÆã„Çä${item.remainingCount}ÂÄã`);
                        });
                    });
                } catch (e) {
                    console.error('ÁèæÂú®„ÅÆ„Éá„Éº„Çø„ÅåÁ†¥Êêç„Åó„Å¶„ÅÑ„Åæ„Åô');
                }
            } else {
                console.warn('ÁèæÂú®„ÅÆ„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
            }
            
            console.log('=== „Éá„Éº„ÇøÁä∂Ê≥ÅÁ¢∫Ë™çÂÆå‰∫Ü ===');
        }

        // Á∑äÊÄ•Áî®ÔºöUIË°®Á§∫„ÇíÂº∑Âà∂Êõ¥Êñ∞„Åô„Çã
        function forceUpdateUI() {
            console.log('=== UIÂº∑Âà∂Êõ¥Êñ∞ÈñãÂßã ===');
            
            // ÊôØÂìÅË®≠ÂÆö„ÅÆË°®Á§∫„ÇíÊõ¥Êñ∞
            loadPrizeSettings();
            
            // Â∞ë„ÅóÈÅÖÂª∂„ÇíÂÖ•„Çå„Å¶Á¢∫ÁéáË®≠ÂÆö„ÇíÊõ¥Êñ∞
            setTimeout(() => {
                updateProbabilityItemStyles();
                updateProbabilityTotal();
                console.log('=== UIÂº∑Âà∂Êõ¥Êñ∞ÂÆå‰∫Ü ===');
            }, 150);
        }

        // Á∑äÊÄ•Áî®ÔºöÁÆ°ÁêÜÁîªÈù¢„ÇíÂº∑Âà∂ÁöÑ„Å´„É™„Éï„É¨„ÉÉ„Ç∑„É•„Åô„ÇãÈñ¢Êï∞
        function forceRefreshAdmin() {
            console.log('*** ÁÆ°ÁêÜÁîªÈù¢Âº∑Âà∂„É™„Éï„É¨„ÉÉ„Ç∑„É•ÈñãÂßã ***');
            
            // ÁèæÂú®„ÅÆlocalStorage„ÅÆÂÜÖÂÆπ„ÇíÁ¢∫Ë™ç
            const currentData = localStorage.getItem(PRIZE_SETTINGS_KEY);
            console.log('„É™„Éï„É¨„ÉÉ„Ç∑„É•Ââç„ÅÆlocalStorage„Éá„Éº„Çø:', currentData);
            
            if (!currentData) {
                console.error('Ë≠¶Âëä: localStorage„Å´„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„ÇìÔºÅ');
                return;
            }
            
            try {
                const parsedData = JSON.parse(currentData);
                console.log('„É™„Éï„É¨„ÉÉ„Ç∑„É•Ââç„ÅÆËß£ÊûêÊ∏à„Åø„Éá„Éº„Çø:', parsedData);
                
                // ÁÆ°ÁêÜÁîªÈù¢„ÅÆË°®Á§∫„ÇíÂº∑Âà∂Êõ¥Êñ∞
                loadPrizeSettings();
                
                // Â∞ë„ÅóÈÅÖÂª∂„ÇíÂÖ•„Çå„Å¶Á¢∫ÁéáË®≠ÂÆö„ÇíÊõ¥Êñ∞
                setTimeout(() => {
                    updateProbabilityItemStyles();
                    updateProbabilityTotal();
                }, 100);
                
                // „É™„Éï„É¨„ÉÉ„Ç∑„É•Âæå„ÇÇÁ¢∫Ë™ç
                const afterData = localStorage.getItem(PRIZE_SETTINGS_KEY);
                console.log('„É™„Éï„É¨„ÉÉ„Ç∑„É•Âæå„ÅÆlocalStorage„Éá„Éº„Çø:', afterData);
                
                if (currentData !== afterData) {
                    console.error('Ë≠¶Âëä: „É™„Éï„É¨„ÉÉ„Ç∑„É•ÂâçÂæå„Åß„Éá„Éº„Çø„ÅåÂ§â„Çè„Çä„Åæ„Åó„ÅüÔºÅ');
                    console.log('Â§âÊõ¥Ââç:', currentData);
                    console.log('Â§âÊõ¥Âæå:', afterData);
                }
                
                console.log('*** ÁÆ°ÁêÜÁîªÈù¢Âº∑Âà∂„É™„Éï„É¨„ÉÉ„Ç∑„É•ÂÆå‰∫Ü ***');
            } catch (error) {
                console.error('„É™„Éï„É¨„ÉÉ„Ç∑„É•„Ç®„É©„Éº:', error);
            }
        }

        // Áµ±‰∏Ä„Åï„Çå„ÅüÊôØÂìÅË®≠ÂÆö‰øùÂ≠òÂá¶ÁêÜ
        function savePrizeSettingsData(settings) {
            console.log('=== Áµ±‰∏ÄÊôØÂìÅË®≠ÂÆö‰øùÂ≠òÂá¶ÁêÜ ===');
            console.log('‰øùÂ≠òÂâç„ÅÆË®≠ÂÆö:', settings);
            
            try {
                localStorage.setItem(PRIZE_SETTINGS_KEY, JSON.stringify(settings));
                console.log('‰øùÂ≠òÂá¶ÁêÜÂÆå‰∫Ü');
                
                // ‰øùÂ≠òÂæå„Å´Á¢∫Ë™ç
                const saved = localStorage.getItem(PRIZE_SETTINGS_KEY);
                const parsedSaved = JSON.parse(saved);
                console.log('‰øùÂ≠òÂæå„ÅÆÁ¢∫Ë™ç:', parsedSaved);
                console.log('=== ÊôØÂìÅË®≠ÂÆö‰øùÂ≠òÂÆå‰∫Ü ===');
                return true;
            } catch (error) {
                console.error('‰øùÂ≠ò„Ç®„É©„Éº:', error);
                return false;
            }
        }

        // Á¢∫ÁéáË®≠ÂÆö„ÇíÂèñÂæó
        function getProbabilitySettings() {
            const stored = localStorage.getItem(PROBABILITY_SETTINGS_KEY);
            return stored ? JSON.parse(stored) : JSON.parse(JSON.stringify(DEFAULT_PROBABILITY_SETTINGS));
        }

        // Á¢∫ÁéáË®≠ÂÆö„Çí‰øùÂ≠ò
        function saveProbabilitySettings(settings) {
            localStorage.setItem(PROBABILITY_SETTINGS_KEY, JSON.stringify(settings));
        }

        // „ÇØ„É©„ÇπÂà•Ë®≠ÂÆö„ÇíÂèñÂæó
        function getClassSettings() {
            const stored = localStorage.getItem(CLASS_SETTINGS_KEY);
            return stored ? JSON.parse(stored) : JSON.parse(JSON.stringify(DEFAULT_CLASS_SETTINGS));
        }

        // „ÇØ„É©„ÇπÂà•Ë®≠ÂÆö„Çí‰øùÂ≠ò
        function saveClassSettingsData(settings) {
            localStorage.setItem(CLASS_SETTINGS_KEY, JSON.stringify(settings));
        }

        // ÊôØÂìÅË®≠ÂÆö„Çí‰øùÂ≠òÔºàUI „Åã„ÇâÂëº„Å≥Âá∫„Åï„Çå„ÇãÔºâ
        function savePrizeSettings() {
            console.log('*** UIÊôØÂìÅË®≠ÂÆö‰øùÂ≠òÈñãÂßã ***');
            
            // ÁèæÂú®„ÅÆË®≠ÂÆö„ÇíÂèñÂæó„Åó„Å¶„ÄÅÊó¢Â≠ò„Éá„Éº„Çø„Çí‰øùÊåÅ
            const currentSettings = getPrizeSettings();
            console.log('ÁèæÂú®„ÅÆË®≠ÂÆö:', currentSettings);
            
            const newSettings = {};
            const prizes = ['special', '1tou', '2tou', '3tou', '4tou', '5tou'];
            
            prizes.forEach(prize => {
                const prizeItems = [];
                const container = document.getElementById(`${prize}-items`);
                
                if (container) {
                    const items = container.querySelectorAll('.prize-item');
                    console.log(`${prize}„ÅÆÊôØÂìÅ„Ç¢„Ç§„ÉÜ„É†Êï∞:`, items.length);
                    
                    items.forEach((item, index) => {
                        const nameInput = item.querySelector(`input[data-type="name"]`);
                        const remainingInput = item.querySelector(`input[data-type="remaining"]`);
                        
                        if (nameInput && remainingInput) {
                            const name = nameInput.value.trim();
                            const remainingCount = parseInt(remainingInput.value) || 0;
                            
                            if (name) { // ÂêçÂâç„Åå„ÅÇ„Çå„Å∞ÊÆã„ÇäÂÄãÊï∞„Åå0„Åß„ÇÇ‰øùÂ≠ò
                                prizeItems.push({
                                    name: name,
                                    totalCount: remainingCount, // Á∑èÊï∞„ÇÇÊÆã„ÇäÊï∞„Å®Âêå„Åò„Å´Ë®≠ÂÆö
                                    remainingCount: remainingCount
                                });
                                console.log(`${prize}[${index}]: ${name} - ${remainingCount}ÂÄã`);
                            }
                        }
                    });
                } else {
                    console.log(`${prize}„ÅÆ„Ç≥„É≥„ÉÜ„Éä„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì`);
                    // Êó¢Â≠ò„ÅÆË®≠ÂÆö„Çí‰øùÊåÅ
                    prizeItems.push(...(currentSettings[prize] || []));
                }
                
                newSettings[prize] = prizeItems;
            });
            
            console.log('Êñ∞„Åó„ÅÑË®≠ÂÆö:', newSettings);
            
            const saveSuccess = savePrizeSettingsData(newSettings);
            
            if (saveSuccess) {
                alert('ÊôØÂìÅË®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
                console.log('*** UIÊôØÂìÅË®≠ÂÆö‰øùÂ≠òÊàêÂäü ***');
                
                // Âº∑Âà∂„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅßÁ¢∫ÂÆü„Å´Êõ¥Êñ∞
                setTimeout(() => {
                    forceRefreshAdmin();
                }, 100);
            } else {
                alert('ÊôØÂìÅË®≠ÂÆö„ÅÆ‰øùÂ≠ò„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ');
                console.error('*** UIÊôØÂìÅË®≠ÂÆö‰øùÂ≠òÂ§±Êïó ***');
            }
        }

        // Á¢∫ÁéáË®≠ÂÆö„Çí‰øùÂ≠òÔºàUI „Åã„ÇâÂëº„Å≥Âá∫„Åï„Çå„ÇãÔºâ
        function saveProbabilitySettingsUI() {
            const settings = {
                special: parseInt(document.getElementById('prob-special').value) || 0,
                '1tou': parseInt(document.getElementById('prob-1tou').value) || 0,
                '2tou': parseInt(document.getElementById('prob-2tou').value) || 0,
                '3tou': parseInt(document.getElementById('prob-3tou').value) || 0,
                '4tou': parseInt(document.getElementById('prob-4tou').value) || 0,
                '5tou': parseInt(document.getElementById('prob-5tou').value) || 0,
                hazure: parseInt(document.getElementById('prob-hazure').value) || 0
            };
            
            const total = settings.special + settings['1tou'] + settings['2tou'] + settings['3tou'] + settings['4tou'] + settings['5tou'] + settings.hazure;
            
            // Âú®Â∫´„ÉÅ„Çß„ÉÉ„ÇØÔºöÂú®Â∫´„Åå„Å™„ÅÑÊôØÂìÅ„ÅØ0%„Åß„ÇÇË®±ÂèØ
            const prizeSettings = getPrizeSettings();
            const validationResult = validateProbabilitySettings(settings, prizeSettings);
            
            if (!validationResult.isValid) {
                alert(validationResult.message);
                return;
            }
            
            console.log('Á¢∫ÁéáË®≠ÂÆö„Çí‰øùÂ≠ò:', settings, 'ÂêàË®à:', total);
            saveProbabilitySettings(settings);
            alert('Á¢∫ÁéáË®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
            loadProbabilitySettings();
        }

        // Á¢∫ÁéáË®≠ÂÆö„ÅÆÊ§úË®º
        function validateProbabilitySettings(settings, prizeSettings) {
            const prizeKeys = ['special', '1tou', '2tou', '3tou', '4tou', '5tou'];
            
            // Âú®Â∫´„Åå„ÅÇ„ÇãÊôØÂìÅ„ÇíÁâπÂÆö
            const availablePrizes = prizeKeys.filter(key => {
                const items = prizeSettings[key] || [];
                return items.some(item => item.remainingCount > 0);
            });
            
            // „Éè„Ç∫„É¨„ÅØÂ∏∏„Å´Âà©Áî®ÂèØËÉΩ
            availablePrizes.push('hazure');
            
            // Âú®Â∫´„Åå„ÅÇ„ÇãÊôØÂìÅ„ÅÆÁ¢∫Áéá„ÅÆÂêàË®à„ÇíË®àÁÆó
            let availableTotal = 0;
            let outOfStockPrizes = [];
            
            Object.keys(settings).forEach(key => {
                if (availablePrizes.includes(key)) {
                    availableTotal += settings[key];
                } else if (settings[key] > 0) {
                    // Âú®Â∫´„Åå„Å™„ÅÑ„ÅÆ„Å´Á¢∫Áéá„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„Çã
                    const displayName = key === 'hazure' ? '„Éè„Ç∫„É¨' : 
                                      key === 'special' ? 'ÁâπÂà•Ë≥û' : 
                                      key.replace('tou', 'Á≠â');
                    outOfStockPrizes.push(displayName);
                }
            });
            
            // Âú®Â∫´„Åå„Å™„ÅÑÊôØÂìÅ„Å´Á¢∫Áéá„ÅåË®≠ÂÆö„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà
            if (outOfStockPrizes.length > 0) {
                return {
                    isValid: false,
                    message: `‰ª•‰∏ã„ÅÆÊôØÂìÅ„ÅØÂú®Â∫´„Åå„Å™„ÅÑ„Åü„ÇÅÁ¢∫Áéá„Çí0%„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºö\n${outOfStockPrizes.join(', ')}`
                };
            }
            
            // Âú®Â∫´„Åå„ÅÇ„ÇãÊôØÂìÅ„ÅÆÁ¢∫Áéá„ÅÆÂêàË®à„Åå100%„Åß„Å™„ÅÑÂ†¥Âêà
            if (availableTotal !== 100) {
                const availableNames = availablePrizes.map(key => 
                    key === 'hazure' ? '„Éè„Ç∫„É¨' : 
                    key === 'special' ? 'ÁâπÂà•Ë≥û' : 
                    key.replace('tou', 'Á≠â')
                );
                
                return {
                    isValid: false,
                    message: `Âú®Â∫´„Åå„ÅÇ„ÇãÊôØÂìÅ„ÅÆÁ¢∫Áéá„ÅÆÂêàË®à„Åå${availableTotal}%„Åß„Åô„ÄÇ\nÂú®Â∫´„Åå„ÅÇ„ÇãÊôØÂìÅÔºà${availableNames.join(', ')}Ôºâ„ÅÆÁ¢∫Áéá„ÅÆÂêàË®à„Çí100%„Å´„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`
                };
            }
            
            return { isValid: true };
        }

        // ÊôØÂìÅË®≠ÂÆö„ÇíUI„Å´Ë™≠„ÅøËæº„Åø
        function loadPrizeSettings() {
            console.log('=== ÊôØÂìÅË®≠ÂÆöUIË™≠„ÅøËæº„ÅøÈñãÂßã ===');
            
            // „Éá„Éº„ÇøÂèñÂæóÂâç„ÅÆÁä∂ÊÖã„ÇíË®òÈå≤
            const beforeData = localStorage.getItem(PRIZE_SETTINGS_KEY);
            console.log('Ë™≠„ÅøËæº„ÅøÂâç„ÅÆlocalStorage„Éá„Éº„Çø:', beforeData);
            
            const settings = getPrizeSettings();
            console.log('Ë™≠„ÅøËæº„Çì„Å†ÊôØÂìÅË®≠ÂÆö:', settings);
            
            // „Éá„Éº„ÇøÂèñÂæóÂæå„ÅÆÁä∂ÊÖã„ÇíÁ¢∫Ë™ç
            const afterData = localStorage.getItem(PRIZE_SETTINGS_KEY);
            console.log('Ë™≠„ÅøËæº„ÅøÂæå„ÅÆlocalStorage„Éá„Éº„Çø:', afterData);
            
            if (beforeData !== afterData) {
                console.warn('Ë≠¶Âëä: getPrizeSettings()„Åå„Éá„Éº„Çø„ÇíÂ§âÊõ¥„Åó„Åæ„Åó„ÅüÔºÅ');
                console.log('Â§âÊõ¥Ââç:', beforeData);
                console.log('Â§âÊõ¥Âæå:', afterData);
            }
            
            renderPrizeGroups(settings);
            console.log('=== ÊôØÂìÅË®≠ÂÆöUIË™≠„ÅøËæº„ÅøÂÆå‰∫Ü ===');
        }

        // Á¢∫ÁéáË®≠ÂÆö„ÇíUI„Å´Ë™≠„ÅøËæº„Åø
        function loadProbabilitySettings() {
            const settings = getProbabilitySettings();
            const prizeSettings = getPrizeSettings();
            
            document.getElementById('prob-special').value = settings.special;
            document.getElementById('prob-1tou').value = settings['1tou'];
            document.getElementById('prob-2tou').value = settings['2tou'];
            document.getElementById('prob-3tou').value = settings['3tou'];
            document.getElementById('prob-4tou').value = settings['4tou'];
            document.getElementById('prob-5tou').value = settings['5tou'];
            document.getElementById('prob-hazure').value = settings.hazure;
            
            // Âú®Â∫´Áä∂Ê≥Å„Å´Âü∫„Å•„ÅÑ„Å¶Ë¶ñË¶öÁöÑ„Çπ„Çø„Ç§„É´„ÇíÈÅ©Áî®
            updateProbabilityItemStyles();
            
            updateProbabilityTotal();
        }

        // „ÇØ„É©„ÇπÂà•Ë®≠ÂÆö„ÇíUI„Å´Ë™≠„ÅøËæº„Åø
        function loadClassSettings() {
            const settings = getClassSettings();
            renderClassSettings(settings);
        }

        // „ÇØ„É©„ÇπÂà•Ë®≠ÂÆö„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderClassSettings(settings) {
            const container = document.getElementById('class-settings-container');
            if (!container) return;
            
            container.innerHTML = '';
            
            const prizeNames = {
                'special': 'ÁâπÂà•Ë≥û',
                '1tou': '1Á≠â',
                '2tou': '2Á≠â',
                '3tou': '3Á≠â',
                '4tou': '4Á≠â',
                '5tou': '5Á≠â',
                'hazure': '„Éè„Ç∫„É¨'
            };
            
            // ÂÖ®„ÇØ„É©„Çπ„ÇíÂá¶ÁêÜ
            Object.keys(DEFAULT_CLASS_SETTINGS).forEach(className => {
                const classSetting = settings[className] || DEFAULT_CLASS_SETTINGS[className];
                
                const classItem = document.createElement('div');
                classItem.className = 'class-setting-item';
                
                const header = document.createElement('div');
                header.className = 'class-setting-header';
                
                const nameDiv = document.createElement('div');
                nameDiv.className = 'class-name';
                nameDiv.textContent = className;
                
                header.appendChild(nameDiv);
                
                const settingGrid = document.createElement('div');
                settingGrid.className = 'setting-grid';
                
                // ÂΩìÈÅ∏ÂèØËÉΩÁ≠âÁ¥öË®≠ÂÆö
                const prizeLevelsDiv = document.createElement('div');
                prizeLevelsDiv.className = 'prize-levels-setting';
                
                const prizeLevelsLabel = document.createElement('div');
                prizeLevelsLabel.className = 'setting-label';
                prizeLevelsLabel.textContent = 'ÂΩìÈÅ∏ÂèØËÉΩÁ≠âÁ¥ö';
                
                const prizeCheckboxes = document.createElement('div');
                prizeCheckboxes.className = 'prize-checkboxes';
                
                Object.keys(prizeNames).forEach(prizeKey => {
                    const checkboxItem = document.createElement('div');
                    checkboxItem.className = 'prize-checkbox-item';
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `${className}-${prizeKey}`;
                    checkbox.value = prizeKey;
                    checkbox.checked = classSetting.allowedPrizes.includes(prizeKey);
                    
                    const label = document.createElement('label');
                    label.setAttribute('for', `${className}-${prizeKey}`);
                    label.textContent = prizeNames[prizeKey];
                    
                    checkboxItem.appendChild(checkbox);
                    checkboxItem.appendChild(label);
                    prizeCheckboxes.appendChild(checkboxItem);
                });
                
                prizeLevelsDiv.appendChild(prizeLevelsLabel);
                prizeLevelsDiv.appendChild(prizeCheckboxes);
                
                // ÂΩìÈÅ∏Âà∂ÈôêË®≠ÂÆö
                const drawLimitDiv = document.createElement('div');
                drawLimitDiv.className = 'draw-limit-setting';
                
                const drawLimitLabel = document.createElement('div');
                drawLimitLabel.className = 'setting-label';
                drawLimitLabel.textContent = 'ÂΩìÈÅ∏Âà∂Èôê';
                
                const drawLimitInputDiv = document.createElement('div');
                drawLimitInputDiv.className = 'draw-limit-input';
                
                const maxWinsLabel = document.createElement('span');
                maxWinsLabel.textContent = 'ÊúÄÂ§ßÂΩìÈÅ∏ÂõûÊï∞:';
                
                const maxWinsInput = document.createElement('input');
                maxWinsInput.type = 'number';
                maxWinsInput.id = `${className}-maxWins`;
                maxWinsInput.min = '1';
                maxWinsInput.max = '10';
                maxWinsInput.value = classSetting.maxWins || 1;
                
                const maxWinsUnit = document.createElement('span');
                maxWinsUnit.textContent = 'Âõû„Åæ„ÅßÂΩìÈÅ∏ÂèØ';
                
                drawLimitInputDiv.appendChild(maxWinsLabel);
                drawLimitInputDiv.appendChild(maxWinsInput);
                drawLimitInputDiv.appendChild(maxWinsUnit);
                
                const intervalDiv = document.createElement('div');
                intervalDiv.className = 'interval-setting';
                
                const intervalLabel = document.createElement('div');
                intervalLabel.className = 'setting-label';
                intervalLabel.textContent = 'ÊäΩÈÅ∏ÈñìÈöî (1 = ÊØéÊó•ÂèØËÉΩ)';
                intervalLabel.style.fontSize = '0.9em';
                intervalLabel.style.marginTop = '10px';
                intervalLabel.style.marginBottom = '5px';
                
                const intervalInputDiv = document.createElement('div');
                intervalInputDiv.className = 'interval-input';
                
                const intervalInput = document.createElement('input');
                intervalInput.type = 'number';
                intervalInput.id = `${className}-interval`;
                intervalInput.min = '1';
                intervalInput.max = '30';
                intervalInput.value = classSetting.drawInterval;
                
                const intervalUnit = document.createElement('span');
                intervalUnit.textContent = 'Êó•„Å´1Âõû';
                
                intervalInputDiv.appendChild(intervalInput);
                intervalInputDiv.appendChild(intervalUnit);
                
                intervalDiv.appendChild(intervalLabel);
                intervalDiv.appendChild(intervalInputDiv);
                
                drawLimitDiv.appendChild(drawLimitLabel);
                drawLimitDiv.appendChild(drawLimitInputDiv);
                drawLimitDiv.appendChild(intervalDiv);
                
                settingGrid.appendChild(prizeLevelsDiv);
                settingGrid.appendChild(drawLimitDiv);
                
                classItem.appendChild(header);
                classItem.appendChild(settingGrid);
                
                container.appendChild(classItem);
            });
        }

        // „ÇØ„É©„ÇπÂà•Ë®≠ÂÆö„Çí‰øùÂ≠òÔºàUI„Åã„ÇâÂëº„Å≥Âá∫„Åï„Çå„ÇãÔºâ
        function saveClassSettings() {
            const settings = {};
            
            Object.keys(DEFAULT_CLASS_SETTINGS).forEach(className => {
                // ÂΩìÈÅ∏ÂèØËÉΩÁ≠âÁ¥ö„ÇíÂèñÂæó
                const allowedPrizes = [];
                const checkboxes = document.querySelectorAll(`input[id^="${className}-"]:checked`);
                checkboxes.forEach(checkbox => {
                    if (checkbox.value !== '') {
                        allowedPrizes.push(checkbox.value);
                    }
                });
                
                // ÊúÄÂ§ßÂΩìÈÅ∏ÂõûÊï∞„ÇíÂèñÂæó
                const maxWinsInput = document.getElementById(`${className}-maxWins`);
                const maxWins = maxWinsInput ? parseInt(maxWinsInput.value) || 1 : 1;
                
                // ÊäΩÈÅ∏ÈñìÈöî„ÇíÂèñÂæó
                const intervalInput = document.getElementById(`${className}-interval`);
                const drawInterval = intervalInput ? parseInt(intervalInput.value) || 1 : 1;
                
                settings[className] = {
                    allowedPrizes: allowedPrizes,
                    maxWins: maxWins,
                    drawInterval: drawInterval
                };
            });
            
            console.log('‰øùÂ≠ò„Åô„Çã„ÇØ„É©„ÇπË®≠ÂÆö:', settings);
            saveClassSettingsData(settings);
            alert('„ÇØ„É©„ÇπÂà•Ë®≠ÂÆö„Çí‰øùÂ≠ò„Åó„Åæ„Åó„ÅüÔºÅ');
        }

        // Á¢∫ÁéáË®≠ÂÆöÈ†ÖÁõÆ„ÅÆË¶ñË¶öÁöÑ„Çπ„Çø„Ç§„É´„ÇíÊõ¥Êñ∞
        function updateProbabilityItemStyles() {
            console.log('=== Á¢∫ÁéáË®≠ÂÆö„Çπ„Çø„Ç§„É´Êõ¥Êñ∞ÈñãÂßã ===');
            const prizeSettings = getPrizeSettings();
            console.log('ÂèñÂæó„Åó„ÅüÊôØÂìÅË®≠ÂÆö:', prizeSettings);
            
            const prizeKeys = ['special', '1tou', '2tou', '3tou', '4tou', '5tou'];
            
            prizeKeys.forEach(key => {
                const items = prizeSettings[key] || [];
                console.log(`${key}„ÅÆÊôØÂìÅ‰∏ÄË¶ß:`, items);
                
                const hasStock = items.some(item => {
                    const stockExists = item.remainingCount > 0;
                    console.log(`  ${item.name}: ÊÆã„Çä${item.remainingCount}ÂÄã - Âú®Â∫´${stockExists ? '„ÅÇ„Çä' : '„Å™„Åó'}`);
                    return stockExists;
                });
                
                console.log(`${key}„ÅÆÂú®Â∫´Âà§ÂÆö: ${hasStock ? 'Âú®Â∫´„ÅÇ„Çä' : 'Âú®Â∫´„Å™„Åó'}`);
                
                const itemElement = document.querySelector(`#prob-${key}`);
                if (itemElement) {
                    const probabilityItem = itemElement.closest('.probability-item');
                    if (probabilityItem) {
                        if (!hasStock) {
                            probabilityItem.classList.add('out-of-stock');
                            console.log(`${key}: Âú®Â∫´Âàá„Çå„Çπ„Çø„Ç§„É´ÈÅ©Áî®`);
                        } else {
                            probabilityItem.classList.remove('out-of-stock');
                            console.log(`${key}: Âú®Â∫´Âàá„Çå„Çπ„Çø„Ç§„É´ÂâäÈô§`);
                        }
                    } else {
                        console.warn(`${key}: probability-item„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì`);
                    }
                } else {
                    console.warn(`${key}: Á¢∫ÁéáÂÖ•ÂäõË¶ÅÁ¥†„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì`);
                }
            });
            
            // „Éè„Ç∫„É¨„ÅØÂ∏∏„Å´Âà©Áî®ÂèØËÉΩ„Å™„ÅÆ„Åßout-of-stock„ÇØ„É©„Çπ„ÇíÂâäÈô§
            const hazureElement = document.querySelector('#prob-hazure');
            if (hazureElement) {
                const hazureProbabilityItem = hazureElement.closest('.probability-item');
                if (hazureProbabilityItem) {
                    hazureProbabilityItem.classList.remove('out-of-stock');
                    console.log('„Éè„Ç∫„É¨: Âú®Â∫´Âàá„Çå„Çπ„Çø„Ç§„É´ÂâäÈô§');
                }
            }
            
            console.log('=== Á¢∫ÁéáË®≠ÂÆö„Çπ„Çø„Ç§„É´Êõ¥Êñ∞ÂÆå‰∫Ü ===');
        }

        // Á¢∫Áéá„ÅÆÂêàË®àÂÄ§„ÇíÊõ¥Êñ∞
        function updateProbabilityTotal() {
            console.log('=== Á¢∫ÁéáÂêàË®àÂÄ§Êõ¥Êñ∞ÈñãÂßã ===');
            
            const settings = {
                special: parseInt(document.getElementById('prob-special').value) || 0,
                '1tou': parseInt(document.getElementById('prob-1tou').value) || 0,
                '2tou': parseInt(document.getElementById('prob-2tou').value) || 0,
                '3tou': parseInt(document.getElementById('prob-3tou').value) || 0,
                '4tou': parseInt(document.getElementById('prob-4tou').value) || 0,
                '5tou': parseInt(document.getElementById('prob-5tou').value) || 0,
                hazure: parseInt(document.getElementById('prob-hazure').value) || 0
            };
            
            console.log('ÁèæÂú®„ÅÆÁ¢∫ÁéáË®≠ÂÆö:', settings);
            
            const prizeSettings = getPrizeSettings();
            console.log('ÊôØÂìÅË®≠ÂÆö:', prizeSettings);
            
            const prizeKeys = ['special', '1tou', '2tou', '3tou', '4tou', '5tou'];
            
            // Âú®Â∫´„Åå„ÅÇ„ÇãÊôØÂìÅ„ÇíÁâπÂÆö
            const availablePrizes = prizeKeys.filter(key => {
                const items = prizeSettings[key] || [];
                const hasStock = items.some(item => item.remainingCount > 0);
                console.log(`${key}: Âú®Â∫´${hasStock ? '„ÅÇ„Çä' : '„Å™„Åó'} („Ç¢„Ç§„ÉÜ„É†Êï∞: ${items.length})`);
                items.forEach((item, index) => {
                    console.log(`  ${index}: ${item.name} - ÊÆã„Çä${item.remainingCount}ÂÄã`);
                });
                return hasStock;
            });
            availablePrizes.push('hazure'); // „Éè„Ç∫„É¨„ÅØÂ∏∏„Å´Âà©Áî®ÂèØËÉΩ
            
            console.log('Âú®Â∫´„Åå„ÅÇ„ÇãÊôØÂìÅ:', availablePrizes);
            
            // ÂÖ®‰Ωì„ÅÆÂêàË®à„Å®Âú®Â∫´„Åå„ÅÇ„ÇãÊôØÂìÅ„ÅÆÂêàË®à„ÇíË®àÁÆó
            const totalAll = Object.values(settings).reduce((sum, val) => sum + val, 0);
            let totalAvailable = 0;
            let hasOutOfStockWithProbability = false;
            
            Object.keys(settings).forEach(key => {
                if (availablePrizes.includes(key)) {
                    totalAvailable += settings[key];
                    console.log(`${key}: Âú®Â∫´„ÅÇ„Çä - Á¢∫Áéá${settings[key]}%`);
                } else if (settings[key] > 0) {
                    hasOutOfStockWithProbability = true;
                    console.log(`${key}: Âú®Â∫´„Å™„Åó - Á¢∫Áéá${settings[key]}%ÔºàÂïèÈ°åÔºâ`);
                }
            });
            
            console.log(`ÂÖ®‰ΩìÂêàË®à: ${totalAll}, Âà©Áî®ÂèØËÉΩÂêàË®à: ${totalAvailable}, Âú®Â∫´Âàá„ÇåÊôØÂìÅ„Å´Á¢∫ÁéáË®≠ÂÆö: ${hasOutOfStockWithProbability}`);
            
            // Ë°®Á§∫Êõ¥Êñ∞
            const totalElement = document.getElementById('probability-total-value');
            const saveButton = document.querySelector('.save-settings-btn[onclick="saveProbabilitySettingsUI()"]');
            
            if (hasOutOfStockWithProbability) {
                totalElement.textContent = `${totalAll} (Âú®Â∫´Âàá„ÇåÊôØÂìÅ„Å´Á¢∫ÁéáË®≠ÂÆö„ÅÇ„Çä)`;
                totalElement.style.color = '#dc3545';
                saveButton.disabled = true;
                saveButton.textContent = 'Á¢∫ÁéáË®≠ÂÆö„Çí‰øùÂ≠òÔºàÁÑ°ÂäπÔºâ';
                console.log('ÁµêÊûú: Âú®Â∫´Âàá„ÇåÊôØÂìÅ„Å´Á¢∫ÁéáË®≠ÂÆö„ÅÇ„Çä');
            } else if (totalAvailable === 100) {
                totalElement.textContent = totalAvailable;
                totalElement.style.color = '#28a745';
                saveButton.disabled = false;
                saveButton.textContent = 'Á¢∫ÁéáË®≠ÂÆö„Çí‰øùÂ≠ò';
                console.log('ÁµêÊûú: 100%„Åß‰øùÂ≠òÂèØËÉΩ');
            } else {
                totalElement.textContent = `${totalAvailable} (Âú®Â∫´„Åå„ÅÇ„ÇãÊôØÂìÅ„ÅÆ„Åø)`;
                totalElement.style.color = '#dc3545';
                saveButton.disabled = true;
                saveButton.textContent = 'Á¢∫ÁéáË®≠ÂÆö„Çí‰øùÂ≠òÔºà100%„Åß„Å™„ÅÑÔºâ';
                console.log('ÁµêÊûú: 100%„Åß„Å™„ÅÑ');
            }
            
            console.log('=== Á¢∫ÁéáÂêàË®àÂÄ§Êõ¥Êñ∞ÂÆå‰∫Ü ===');
        }

        // ÊôØÂìÅ„Ç∞„É´„Éº„Éó„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
        function renderPrizeGroups(settings) {
            console.log('*** renderPrizeGroupsÈñãÂßã ***');
            console.log('„É¨„É≥„ÉÄ„É™„É≥„Ç∞ÂØæË±°„ÅÆË®≠ÂÆö:', settings);
            
            const container = document.getElementById('prize-groups-container');
            if (!container) {
                console.error('prize-groups-container„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');
                return;
            }
            
            // ÂÆåÂÖ®„Å´„ÇØ„É™„Ç¢
            container.innerHTML = '';
            console.log('„Ç≥„É≥„ÉÜ„Éä„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü');
            
            const prizeNames = {
                'special': 'ÁâπÂà•Ë≥û',
                '1tou': '1Á≠â',
                '2tou': '2Á≠â', 
                '3tou': '3Á≠â',
                '4tou': '4Á≠â',
                '5tou': '5Á≠â'
            };
            
            Object.keys(prizeNames).forEach(prizeKey => {
                console.log(`${prizeKey}Ôºà${prizeNames[prizeKey]}Ôºâ„ÅÆÂá¶ÁêÜÈñãÂßã`);
                
                const prizeGroup = document.createElement('div');
                prizeGroup.className = 'prize-group';
                
                const header = document.createElement('div');
                header.className = 'prize-group-header';
                
                const title = document.createElement('div');
                title.className = 'prize-group-title';
                title.textContent = prizeNames[prizeKey];
                
                const addBtn = document.createElement('button');
                addBtn.className = 'add-prize-btn';
                addBtn.textContent = '+ ÊôØÂìÅËøΩÂä†';
                addBtn.onclick = () => addPrizeItem(prizeKey);
                
                header.appendChild(title);
                header.appendChild(addBtn);
                
                const itemsContainer = document.createElement('div');
                itemsContainer.id = `${prizeKey}-items`;
                
                prizeGroup.appendChild(header);
                prizeGroup.appendChild(itemsContainer);
                container.appendChild(prizeGroup);
                
                // ÊôØÂìÅ„Ç¢„Ç§„ÉÜ„É†„Çí„É¨„É≥„ÉÄ„É™„É≥„Ç∞
                const items = settings[prizeKey] || [];
                console.log(`${prizeKey}„ÅÆÊôØÂìÅÊï∞:`, items.length);
                
                items.forEach((item, index) => {
                    console.log(`${prizeKey}[${index}]: ${item.name} - ÊÆã„Çä${item.remainingCount}ÂÄã`);
                    addPrizeItemWithData(prizeKey, item, index);
                });
                
                // Á©∫„ÅÆÂ†¥Âêà„ÅØ1„Å§ËøΩÂä†
                if (items.length === 0) {
                    console.log(`${prizeKey}„ÅØÁ©∫„ÅÆ„Åü„ÇÅ„ÄÅÊñ∞Ë¶è„Ç¢„Ç§„ÉÜ„É†„ÇíËøΩÂä†`);
                    addPrizeItem(prizeKey);
                }
                
                console.log(`${prizeKey}„ÅÆÂá¶ÁêÜÂÆå‰∫Ü`);
            });
            
            console.log('*** renderPrizeGroupsÂÆå‰∫Ü ***');
        }

        // ÊôØÂìÅ„Ç¢„Ç§„ÉÜ„É†„ÇíËøΩÂä†
        function addPrizeItem(prizeKey) {
            addPrizeItemWithData(prizeKey, { name: '', totalCount: 1, remainingCount: 1 });
        }

        // „Éá„Éº„Çø‰ªò„Åç„ÅßÊôØÂìÅ„Ç¢„Ç§„ÉÜ„É†„ÇíËøΩÂä†
        function addPrizeItemWithData(prizeKey, data, index = null) {
            console.log(`ÊôØÂìÅ„Ç¢„Ç§„ÉÜ„É†ËøΩÂä†: ${prizeKey}`, data);
            
            const container = document.getElementById(`${prizeKey}-items`);
            const itemCount = container.children.length;
            
            const prizeItem = document.createElement('div');
            prizeItem.className = 'prize-item';
            
            // Âú®Â∫´„Åå0ÂÄã„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Å™„ÇØ„É©„Çπ„ÇíËøΩÂä†
            const remainingCount = typeof data.remainingCount === 'number' ? data.remainingCount : (data.totalCount || 1);
            console.log(`${prizeKey} - ${data.name}: ÊÆã„Çä${remainingCount}ÂÄãÔºàÂÖÉ„Éá„Éº„ÇøÔºöremainingCount=${data.remainingCount}, totalCount=${data.totalCount}Ôºâ`);
            
            if (remainingCount === 0) {
                prizeItem.classList.add('out-of-stock');
                console.log(`${prizeKey} - ${data.name}: Âú®Â∫´Âàá„Çå„Éû„Éº„ÇØËøΩÂä†`);
            }
            
            const label = document.createElement('div');
            label.className = 'prize-label';
            label.textContent = `${itemCount + 1}Áï™ÁõÆ`;
            
            const nameInput = document.createElement('input');
            nameInput.type = 'text';
            nameInput.className = 'prize-input';
            nameInput.setAttribute('data-type', 'name');
            nameInput.placeholder = 'ÊôØÂìÅÂêç„ÇíÂÖ•Âäõ';
            nameInput.value = data.name || '';
            
            const remainingLabel = document.createElement('span');
            remainingLabel.textContent = 'ÊÆã„Çä:';
            
            const stockStatus = document.createElement('span');
            stockStatus.className = 'stock-status';
            if (remainingCount === 0) {
                stockStatus.textContent = '(Âú®Â∫´Âàá„Çå)';
                stockStatus.style.color = '#d32f2f';
                stockStatus.style.fontSize = '0.9em';
                stockStatus.style.marginLeft = '5px';
            }
            
            const remainingInput = document.createElement('input');
            remainingInput.type = 'number';
            remainingInput.className = 'prize-count';
            remainingInput.setAttribute('data-type', 'remaining');
            remainingInput.min = '0';
            remainingInput.max = '999';
            remainingInput.value = remainingCount;
            
            console.log(`ÂÖ•Âäõ„Éï„Ç£„Éº„É´„ÉâË®≠ÂÆö: ${data.name} „ÅÆÂÄ§„Çí ${remainingCount} „Å´Ë®≠ÂÆö`);
            
            // Âú®Â∫´Êï∞Â§âÊõ¥ÊôÇ„ÅÆË¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
            remainingInput.addEventListener('input', function() {
                const currentValue = parseInt(this.value) || 0;
                if (currentValue === 0) {
                    prizeItem.classList.add('out-of-stock');
                    stockStatus.textContent = '(Âú®Â∫´Âàá„Çå)';
                    stockStatus.style.color = '#d32f2f';
                } else {
                    prizeItem.classList.remove('out-of-stock');
                    stockStatus.textContent = '';
                }
                
                // Á¢∫ÁéáË®≠ÂÆö„ÅÆË°®Á§∫„ÇÇÊõ¥Êñ∞ÔºàÂ∞ë„ÅóÈÅÖÂª∂„ÇíÂÖ•„Çå„ÇãÔºâ
                setTimeout(() => {
                    updateProbabilityItemStyles();
                    updateProbabilityTotal();
                }, 50);
            });
            
            const removeBtn = document.createElement('button');
            removeBtn.className = 'remove-prize-btn';
            removeBtn.textContent = 'ÂâäÈô§';
            removeBtn.onclick = () => {
                prizeItem.remove();
                updatePrizeLabels(prizeKey);
            };
            
            prizeItem.appendChild(label);
            prizeItem.appendChild(nameInput);
            prizeItem.appendChild(remainingLabel);
            prizeItem.appendChild(stockStatus);
            prizeItem.appendChild(remainingInput);
            prizeItem.appendChild(removeBtn);
            
            container.appendChild(prizeItem);
            updatePrizeLabels(prizeKey);
        }

        // ÊôØÂìÅ„É©„Éô„É´„ÇíÊõ¥Êñ∞
        function updatePrizeLabels(prizeKey) {
            const container = document.getElementById(`${prizeKey}-items`);
            const items = container.querySelectorAll('.prize-item');
            
            items.forEach((item, index) => {
                const label = item.querySelector('.prize-label');
                label.textContent = `${index + 1}Áï™ÁõÆ`;
            });
        }

        // ‰ªäÊó•„ÅÆÊó•‰ªò„ÇíÂèñÂæó
        function getTodayString() {
            const now = new Date();
            const year = now.getFullYear();
            const month = (now.getMonth() + 1).toString().padStart(2, '0');
            const day = now.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // ÂèÇÂä†ËÄÖ„ÅÆ„ÇØ„É©„Çπ„ÇíÂèñÂæó
        function getParticipantClass(participantId) {
            return participantId.split('„Éª')[0];
        }

        // Êó•‰ªòÈñì„ÅÆÂ∑Æ„ÇíË®àÁÆó
        function daysBetween(date1, date2) {
            const oneDay = 24 * 60 * 60 * 1000;
            const firstDate = new Date(date1);
            const secondDate = new Date(date2);
            return Math.round(Math.abs((firstDate - secondDate) / oneDay));
        }

        // ÂèÇÂä†ËÄÖ„ÅÆÂºï„ÅÑ„ÅüÂõûÊï∞„ÇíÂèñÂæó
        function getParticipantStats(participantId) {
            const history = getHistory();
            const participant = history[participantId] || { totalCount: 0, dates: [], won5th: false, hasWon: false };
            
            // Êó¢Â≠ò„ÅÆ„Éá„Éº„Çø„ÅÆ‰∫íÊèõÊÄß„Çí‰øù„Å§„Åü„ÇÅ„ÄÅ„Éó„É≠„Éë„ÉÜ„Ç£„Åå„Å™„ÅÑÂ†¥Âêà„ÅØËøΩÂä†
            if (participant.won5th === undefined) {
                participant.won5th = false;
            }
            if (participant.hasWon === undefined) {
                participant.hasWon = false;
            }
            
            const today = getTodayString();
            const participantClass = getParticipantClass(participantId);
            
            // Êñ∞„Åó„ÅÑ„ÇØ„É©„ÇπË®≠ÂÆö„ÇíÂèñÂæó
            const classSettings = getClassSettings();
            const classSetting = classSettings[participantClass] || DEFAULT_CLASS_SETTINGS[participantClass];
            
            const maxWins = classSetting.maxWins || 1;
            const drawInterval = classSetting.drawInterval || 1;
            
            // ÂΩìÈÅ∏ÂõûÊï∞„ÇíÂèñÂæó
            const currentWinCount = getParticipantWinCount(participantId);
            const remainingWins = Math.max(0, maxWins - currentWinCount);

            let canDrawToday = false;
            let statusMessage = '';
            let daysToWait = 0;

            console.log(`=== ${participantClass}„ÅÆÂà∂Èôê„ÉÅ„Çß„ÉÉ„ÇØ ===`);
            console.log('ÊúÄÂ§ßÂΩìÈÅ∏ÂõûÊï∞:', maxWins);
            console.log('ÁèæÂú®„ÅÆÂΩìÈÅ∏ÂõûÊï∞:', currentWinCount);
            console.log('ÊÆã„ÇäÂΩìÈÅ∏ÂèØËÉΩÂõûÊï∞:', remainingWins);
            console.log('ÊäΩÈÅ∏ÈñìÈöî:', drawInterval, 'Êó•„Å´1Âõû');
            console.log('ÁèæÂú®„ÅÆÊäΩÈÅ∏ÂõûÊï∞:', participant.totalCount);

            // ÊäΩÈÅ∏ÈñìÈöî„Çí„ÉÅ„Çß„ÉÉ„ÇØÔºàÂΩìÈÅ∏ÂõûÊï∞Âà∂Èôê„Å´Èñ¢‰øÇ„Å™„ÅèÈÅ©Áî®Ôºâ
            if (drawInterval === 1) {
                // ÊØéÊó•ÊäΩÈÅ∏ÂèØËÉΩ
                canDrawToday = true;
                const todayCount = participant.dates.filter(date => date === today).length;
                if (currentWinCount >= maxWins) {
                    statusMessage = `‰ªäÊó•${todayCount}ÂõûÊäΩÈÅ∏Ê∏à„Åø`;
                } else {
                    statusMessage = `ÊÆã„ÇäÂΩìÈÅ∏${remainingWins}Âõû (‰ªäÊó•${todayCount}ÂõûÊäΩÈÅ∏)`;
                }
                console.log('ÊØéÊó•ÊäΩÈÅ∏ÂèØËÉΩ - ‰ªäÊó•„ÅÆÂõûÊï∞:', todayCount);
            } else {
                // ÈñìÈöîÂà∂Èôê„ÅÇ„Çä
                if (participant.dates.length === 0) {
                    canDrawToday = true;
                    if (currentWinCount >= maxWins) {
                        statusMessage = `ÂàùÂõû`;
                    } else {
                        statusMessage = `ÂàùÂõû / ÊÆã„ÇäÂΩìÈÅ∏${remainingWins}Âõû`;
                    }
                    console.log('ÂàùÂõûÊäΩÈÅ∏');
                } else {
                    const lastDrawDate = participant.dates[participant.dates.length - 1];
                    const daysSinceLastDraw = daysBetween(today, lastDrawDate);
                    
                    console.log('ÊúÄÂæå„ÅÆÊäΩÈÅ∏Êó•:', lastDrawDate);
                    console.log('ÁµåÈÅéÊó•Êï∞:', daysSinceLastDraw);
                    console.log('ÂøÖË¶ÅÈñìÈöî:', drawInterval);
                    
                    if (daysSinceLastDraw >= drawInterval) {
                        canDrawToday = true;
                        if (currentWinCount >= maxWins) {
                            statusMessage = `ÂâçÂõû„Åã„Çâ${daysSinceLastDraw}Êó•ÁµåÈÅé`;
                        } else {
                            statusMessage = `ÂâçÂõû„Åã„Çâ${daysSinceLastDraw}Êó•ÁµåÈÅé / ÊÆã„ÇäÂΩìÈÅ∏${remainingWins}Âõû`;
                        }
                        console.log('ÈñìÈöîÊù°‰ª∂„ÇØ„É™„Ç¢ - ÊäΩÈÅ∏ÂèØËÉΩ');
                    } else {
                        canDrawToday = false;
                        daysToWait = drawInterval - daysSinceLastDraw;
                        if (currentWinCount >= maxWins) {
                            statusMessage = `„ÅÇ„Å®${daysToWait}Êó•ÂæÖ„Å£„Å¶„Å≠`;
                        } else {
                            statusMessage = `„ÅÇ„Å®${daysToWait}Êó•ÂæÖ„Å£„Å¶„Å≠ / ÊÆã„ÇäÂΩìÈÅ∏${remainingWins}Âõû`;
                        }
                        console.log('ÈñìÈöî‰∏çË∂≥ - ÂæÖÊ©üÂøÖË¶Å:', daysToWait, 'Êó•');
                    }
                }
            }
            
            // Á∑èÊäΩÈÅ∏ÂõûÊï∞Âà∂Èôê„Çí„ÉÅ„Çß„ÉÉ„ÇØ
            const totalDrawLimitReached = participant.totalCount >= MAX_TOTAL_DRAWS;
            const remainingDraws = Math.max(0, MAX_TOTAL_DRAWS - participant.totalCount);
            
            // ÊúÄÁµÇÁöÑ„Å™ÊäΩÈÅ∏ÂèØÂê¶Âà§ÂÆöÔºàÊäΩÈÅ∏ÈñìÈöîÂà∂Èôê AND Á∑èÊäΩÈÅ∏ÂõûÊï∞Âà∂ÈôêÔºâ
            const finalCanDraw = canDrawToday && !totalDrawLimitReached;
            
            console.log('Á∑èÊäΩÈÅ∏ÂõûÊï∞:', participant.totalCount, '/', MAX_TOTAL_DRAWS);
            console.log('Á∑èÊäΩÈÅ∏ÂõûÊï∞Âà∂ÈôêÂà∞ÈÅî:', totalDrawLimitReached);
            console.log('ÊúÄÁµÇÂà§ÂÆö - ÊäΩÈÅ∏ÂèØËÉΩ:', finalCanDraw);
            console.log('=== Âà∂Èôê„ÉÅ„Çß„ÉÉ„ÇØÂÆå‰∫Ü ===');
            
            return {
                totalCount: participant.totalCount,
                currentWinCount: currentWinCount,
                remainingWins: remainingWins,
                remainingDraws: remainingDraws,
                canDrawToday: finalCanDraw,
                statusMessage: statusMessage,
                daysToWait: daysToWait,
                maxWins: maxWins,
                winLimitReached: currentWinCount >= maxWins,
                totalDrawLimitReached: totalDrawLimitReached
            };
        }

        // ÂΩìÈÅ∏ËÄÖÊï∞„ÇíÈõÜË®à
        function getTotalWinnerCount() {
            const history = getHistory();
            let totalWinners = 0;

            Object.keys(history).forEach(participantId => {
                const participant = history[participantId];
                if (participant.winHistory) {
                    participant.winHistory.forEach(win => {
                        if (win.prize !== '„Éè„Ç∫„É¨') {
                            totalWinners++;
                        }
                    });
                }
            });

            return totalWinners;
        }

        // ÂèÇÂä†ËÄÖ„ÅÆÂΩìÈÅ∏ÂõûÊï∞„ÇíÂèñÂæó
        function getParticipantWinCount(participantId) {
            const history = getHistory();
            const participant = history[participantId] || { winHistory: [] };
            
            if (!participant.winHistory) {
                return 0;
            }
            
            let winCount = 0;
            participant.winHistory.forEach(win => {
                if (win.prize !== '„Éè„Ç∫„É¨') {
                    winCount++;
                }
            });
            
            return winCount;
        }

        // ÂΩìÈÅ∏ËÄÖÊï∞Ë°®Á§∫„ÇíÊõ¥Êñ∞
        function updateWinnerCountDisplay() {
            const totalWinners = getTotalWinnerCount();
            document.getElementById('total-winners').textContent = totalWinners;
        }

        // ÊäΩÈÅ∏Ë®òÈå≤„ÇíÊõ¥Êñ∞
        function recordDraw(participantId, result, selectedPrize = null) {
            const history = getHistory();
            const today = getTodayString();
            
            if (!history[participantId]) {
                history[participantId] = { totalCount: 0, dates: [], won5th: false, hasWon: false, winHistory: [] };
            }
            
            // Êó¢Â≠ò„Éá„Éº„Çø„ÅÆ‰∫íÊèõÊÄß„Çí‰øù„Å§„Åü„ÇÅ„ÄÅwinHistory„Åå„Å™„ÅÑÂ†¥Âêà„ÅØËøΩÂä†
            if (!history[participantId].winHistory) {
                history[participantId].winHistory = [];
            }
            
            history[participantId].totalCount++;
            history[participantId].dates.push(today);
            
            // ÂΩìÈÅ∏Â±•Ê≠¥„ÇíË®òÈå≤
            let prize = '„Éè„Ç∫„É¨';
            let prizeName = '';
            if (result.image === 'special.jpg') prize = 'ÁâπÂà•Ë≥û';
            else if (result.image === '1tou.jpg') prize = '1Á≠â';
            else if (result.image === '2tou.jpg') prize = '2Á≠â';
            else if (result.image === '3tou.jpg') prize = '3Á≠â';
            else if (result.image === '4tou.jpg') prize = '4Á≠â';
            else if (result.image === '5tou.jpg') prize = '5Á≠â';
            
            // ÂΩìÈÅ∏„Åó„ÅüÊôØÂìÅÂêç„ÇíË®òÈå≤
            if (selectedPrize) {
                prizeName = selectedPrize.name;
            }
            
            history[participantId].winHistory.push({
                date: today,
                prize: prize,
                prizeName: prizeName
            });
            
            // 5Á≠âÂΩìÈÅ∏„ÅÆÂ†¥Âêà„ÅØË®òÈå≤Ôºà‰∫íÊèõÊÄß„ÅÆ„Åü„ÇÅÊÆã„Åó„Å¶„ÅÑ„ÇãÔºâ
            if (result.image === '5tou.jpg') {
                history[participantId].won5th = true;
            }
            
            // ÂΩì„Åü„ÇäÔºà„Éè„Ç∫„É¨‰ª•Â§ñÔºâ„ÅÆÂ†¥Âêà„ÅØË®òÈå≤
            if (result.image !== 'hazure.jpg') {
                history[participantId].hasWon = true;
            }
            
            saveHistory(history);
            
            // ÂΩìÈÅ∏ËÄÖÊï∞Ë°®Á§∫„ÇíÊõ¥Êñ∞
            updateWinnerCountDisplay();
        }

        function generateKuji() {
            const container = document.getElementById('kuji-container');
            const numKuji = 100; // „Åè„Åò„ÅÆÊï∞„ÇíÂ§ßÂπÖ„Å´Â¢óÂä†
            
            // „Ç≥„É≥„ÉÜ„Éä„ÅÆÂÆüÈöõ„ÅÆ„Çµ„Ç§„Ç∫„ÇíÂèñÂæó
            const containerRect = container.getBoundingClientRect();
            const containerWidth = containerRect.width - 160; // ÁîªÂÉè„Çµ„Ç§„Ç∫„ÇíËÄÉÊÖÆ„Åó„Åü„Éû„Éº„Ç∏„É≥
            const containerHeight = containerRect.height - 160;
            
            for (let i = 0; i < numKuji; i++) {
                const kujiItem = document.createElement('div');
                kujiItem.className = 'kuji-item';
                
                // „É©„É≥„ÉÄ„É†„Å™‰ΩçÁΩÆ„Å´ÈÖçÁΩÆÔºà„Éû„Éº„Ç∏„É≥„ÇíËÄÉÊÖÆÔºâ
                const x = Math.random() * Math.max(containerWidth, 100);
                const y = Math.random() * Math.max(containerHeight, 100);
                kujiItem.style.left = x + 'px';
                kujiItem.style.top = y + 'px';
                
                // „É©„É≥„ÉÄ„É†„Å™ÂõûËª¢„ÇíËøΩÂä†
                const rotation = Math.random() * 360;
                kujiItem.style.transform = `rotate(${rotation}deg)`;
                
                const img = document.createElement('img');
                img.src = 'kuji.png';
                img.alt = '„Åè„Åò';
                
                kujiItem.appendChild(img);
                
                kujiItem.addEventListener('click', () => showConfirm());
                
                container.appendChild(kujiItem);
            }
        }



        function showConfirm() {
            // Á¢∫Ë™çÁîªÈù¢„ÇíË°®Á§∫
            document.getElementById('kuji-screen').style.display = 'none';
            document.getElementById('confirm-screen').style.display = 'block';
            
            // ÊôØÂìÅÁîªÂÉè„ÇíÂÜçË°®Á§∫
            document.body.classList.remove('hide-keihin');
        }

        function confirmKuji() {
            // „Äå„ÅØ„ÅÑ„Äç„ÅåÈÅ∏Êäû„Åï„Çå„ÅüÂ†¥Âêà„ÄÅÁµêÊûú„ÇíÂà§ÂÆö
            const result = getResultForParticipant(currentParticipant);
            
            // ÂΩìÈÅ∏„Éª„Éè„Ç∫„É¨Èñ¢‰øÇ„Å™„ÅèÁ¢∫ÂÆöÊºîÂá∫„ÇíË°®Á§∫
            startDrumroll(result);
        }

        function cancelKuji() {
            // „Äå„ÅÑ„ÅÑ„Åà„Äç„ÅåÈÅ∏Êäû„Åï„Çå„ÅüÂ†¥Âêà„ÄÅ„Åè„ÅòÈÅ∏ÊäûÁîªÈù¢„Å´Êàª„Çã
            document.getElementById('confirm-screen').style.display = 'none';
            document.getElementById('kuji-screen').style.display = 'block';
            
            // ÊôØÂìÅÁîªÂÉè„ÇíÈùûË°®Á§∫Ôºà„Åè„ÅòÈÅ∏„Å≥ÁîªÈù¢„Å´Êàª„Çã„Åü„ÇÅÔºâ
            document.body.classList.add('hide-keihin');
        }

        function drawResult(result) {
            // ÊôØÂìÅË®≠ÂÆö„ÇíÂèñÂæó
            const prizeSettings = getPrizeSettings();
            
            // ÁµêÊûú„ÉÜ„Ç≠„Çπ„Éà„Å´ÊôØÂìÅÂêç„ÇíÂê´„ÇÅ„Çã
            let resultText = result.text;
            let selectedPrize = null;
            
            console.log('=== ÊôØÂìÅÂá¶ÁêÜÈñãÂßã ===');
            console.log('ÊäΩÈÅ∏ÁµêÊûú:', result);
            
            if (result.image !== 'hazure.jpg') {
                const prizeKey = result.image.replace('.jpg', '');
                console.log('*** Âú®Â∫´Ê∏õÂ∞ëÂá¶ÁêÜÈñãÂßã ***');
                console.log('ÊôØÂìÅ„Ç≠„Éº:', prizeKey);
                
                // ÊúÄÊñ∞„ÅÆÊôØÂìÅË®≠ÂÆö„ÇíÂÜçÂèñÂæó
                const currentPrizeSettings = getPrizeSettings();
                console.log('ÁèæÂú®„ÅÆÊôØÂìÅË®≠ÂÆö:', currentPrizeSettings);
                
                const prizeItems = currentPrizeSettings[prizeKey] || [];
                console.log('Ë©≤ÂΩì„Åô„ÇãÊôØÂìÅ‰∏ÄË¶ß:', prizeItems);
                
                // Âú®Â∫´„Åå„ÅÇ„ÇãÊôØÂìÅ„ÇíÊé¢„Åô
                const availableIndexes = [];
                prizeItems.forEach((item, index) => {
                    if (item.remainingCount > 0) {
                        availableIndexes.push(index);
                        console.log(`Âú®Â∫´„ÅÇ„Çä: „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ${index} - ${item.name} (ÊÆã„Çä${item.remainingCount}ÂÄã)`);
                    }
                });
                
                if (availableIndexes.length > 0) {
                    // „É©„É≥„ÉÄ„É†„Å´ÈÅ∏Êäû
                    const randomIndex = availableIndexes[Math.floor(Math.random() * availableIndexes.length)];
                    const selectedItem = currentPrizeSettings[prizeKey][randomIndex];
                    
                    console.log(`ÈÅ∏Êäû„Åï„Çå„ÅüÊôØÂìÅ: „Ç§„É≥„Éá„ÉÉ„ÇØ„Çπ${randomIndex} - ${selectedItem.name}`);
                    console.log('Ê∏õÂ∞ëÂâç„ÅÆÊÆã„ÇäÂÄãÊï∞:', selectedItem.remainingCount);
                    
                    resultText = `${result.text}\n${selectedItem.name}`;
                    selectedPrize = { name: selectedItem.name, remainingCount: selectedItem.remainingCount };
                    
                    // Áõ¥Êé•Ê∏õ„Çâ„Åô
                    currentPrizeSettings[prizeKey][randomIndex].remainingCount--;
                    console.log('Ê∏õÂ∞ëÂæå„ÅÆÊÆã„ÇäÂÄãÊï∞:', currentPrizeSettings[prizeKey][randomIndex].remainingCount);
                    
                    // Áµ±‰∏Ä„Åï„Çå„Åü‰øùÂ≠òÂá¶ÁêÜ„Çí‰ΩøÁî®
                    console.log('*** Áµ±‰∏Ä‰øùÂ≠òÂá¶ÁêÜÈñãÂßã ***');
                    const saveSuccess = savePrizeSettingsData(currentPrizeSettings);
                    
                    if (saveSuccess) {
                        console.log('*** ‰øùÂ≠òÊàêÂäü ***');
                        
                        // ÂÜçÂèñÂæó„Åó„Å¶Á¢∫Ë™ç
                        const verification = getPrizeSettings();
                        const verifyItem = verification[prizeKey][randomIndex];
                        console.log('*** ‰øùÂ≠òÁ¢∫Ë™ç ***');
                        console.log(`${verifyItem.name}„ÅÆ‰øùÂ≠òÂæåÊÆã„ÇäÂÄãÊï∞:`, verifyItem.remainingCount);
                        
                        // selectedPrize„ÇíÊõ¥Êñ∞
                        selectedPrize.remainingCount = verifyItem.remainingCount;
                    } else {
                        console.error('*** ‰øùÂ≠òÂ§±Êïó ***');
                    }
                    
                                    // ÁÆ°ÁêÜÁîªÈù¢Êõ¥Êñ∞ÔºàÂº∑Âà∂ÁöÑ„Å´ÂÆüË°åÔºâ
                setTimeout(() => {
                    forceRefreshAdmin();
                }, 100);
                } else {
                    console.log('Âú®Â∫´„Åå„ÅÇ„ÇãÊôØÂìÅ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì');
                }
            } else {
                console.log('„Éè„Ç∫„É¨„ÅÆ„Åü„ÇÅÊôØÂìÅÂá¶ÁêÜ„Çí„Çπ„Ç≠„ÉÉ„Éó');
            }
            
            console.log('=== ÊôØÂìÅÂá¶ÁêÜÁµÇ‰∫Ü ===');
            
            // ÊäΩÈÅ∏Ë®òÈå≤„ÇíÊõ¥Êñ∞ÔºàÊôØÂìÅÂêç„ÇÇÂê´„ÇÅ„Å¶Ôºâ
            console.log('ÊäΩÈÅ∏Ë®òÈå≤„ÇíÊõ¥Êñ∞‰∏≠...', {
                participant: currentParticipant,
                result: result,
                selectedPrize: selectedPrize
            });
            recordDraw(currentParticipant, result, selectedPrize);
            console.log('ÊäΩÈÅ∏Ë®òÈå≤Êõ¥Êñ∞ÂÆå‰∫Ü');
            
            // ÁµêÊûú„ÇíË°®Á§∫
            const resultTextElement = document.getElementById('result-text');
            resultTextElement.innerHTML = resultText.replace('\n', '<br>');
            
            // „Éè„Ç∫„É¨„ÅÆÂ†¥Âêà„ÅØÂõ≤„ÅøÁ∑ö„ÇíÂâäÈô§
            if (result.image === 'hazure.jpg') {
                resultTextElement.classList.add('result-miss-text');
            } else {
                resultTextElement.classList.remove('result-miss-text');
            }
            
            const resultImageElement = document.getElementById('result-image');
            // ÁâπÂà•Ë≥û„ÅÆÂ†¥Âêà„ÅØÁîªÂÉè„ÇíÈùûË°®Á§∫
            if (result.image === 'special.jpg') {
                resultImageElement.style.display = 'none';
            } else {
                resultImageElement.style.display = '';
                resultImageElement.src = result.image;
            }
            
            // ÂΩì„Åü„Çä„ÅÆÂ†¥Âêà„ÅØÂèÇÂä†ËÄÖÊÉÖÂ†±„ÇíË°®Á§∫
            const winnerInfo = document.getElementById('winner-info');
            if (result.image !== 'hazure.jpg') {
                winnerInfo.innerHTML = `ÂΩìÈÅ∏ËÄÖ: ${currentParticipant}`;
                winnerInfo.style.display = 'block';
                startCelebration();
            } else {
                winnerInfo.style.display = 'none';
            }
            
            // ÁîªÈù¢„ÇíÂàá„ÇäÊõø„Åà
            document.getElementById('confirm-screen').style.display = 'none';
            document.getElementById('drumroll-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'block';
            
            // ÂΩìÈÅ∏ËÄÖÊï∞Ë°®Á§∫„ÇíÂÜçË°®Á§∫
            document.body.classList.remove('hide-winner-count');
        }

        function startDrumroll(result) {
            // Á¢∫ÂÆöÊºîÂá∫ÁîªÈù¢„ÇíË°®Á§∫
            document.getElementById('confirm-screen').style.display = 'none';
            document.getElementById('drumroll-screen').style.display = 'block';
            
            // ÂΩìÈÅ∏ËÄÖÊï∞Ë°®Á§∫„ÇíÈùûË°®Á§∫
            document.body.classList.add('hide-winner-count');
            
            // 3Áßí„ÅÆ„Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥
            let countdown = 3;
            const countdownDisplay = document.getElementById('countdown-display');
            
            const countdownInterval = setInterval(() => {
                countdownDisplay.textContent = countdown;
                
                // Êï∞Â≠ó„Åî„Å®„Å´Áï∞„Å™„Çã„ÇØ„É©„Çπ„ÇíËøΩÂä†
                countdownDisplay.className = 'countdown';
                if (countdown === 3) {
                    countdownDisplay.classList.add('countdown-3');
                } else if (countdown === 2) {
                    countdownDisplay.classList.add('countdown-2');
                } else if (countdown === 1) {
                    countdownDisplay.classList.add('countdown-1');
                }
                
                countdown--;
                
                if (countdown < 0) {
                    clearInterval(countdownInterval);
                    // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥ÁµÇ‰∫ÜÂæå„ÄÅÁµêÊûú„ÇíË°®Á§∫
                    drawResult(result);
                }
            }, 1000);
        }

        function updateStatusDisplay(participantId) {
            const drawCounter = document.getElementById('draw-counter');
            const stats = getParticipantStats(participantId);
            const participantClass = getParticipantClass(participantId);
            
            let canProceed = stats.canDrawToday;
            
            console.log(`=== ${participantClass}„ÅÆ„Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫Êõ¥Êñ∞ ===`);
            console.log('Áµ±Ë®àÊÉÖÂ†±:', stats);
            console.log('Âü∫Êú¨Âà§ÂÆö canProceed:', canProceed);
            
            // Âà∂ÈôêÁä∂Ê≥Å„Å´Âøú„Åò„ÅüË°®Á§∫
            let counterClass = 'draw-counter';
            let counterText = '';
            
            if (stats.totalDrawLimitReached) {
                counterClass += ' warning';
                counterText = `<div class="count-numbers">ÊúÄÂ§ßÊäΩÈÅ∏ÂõûÊï∞„Å´ÈÅî„Åó„Åæ„Åó„Åü</div><div>ÊäΩÈÅ∏ÂõûÊï∞: ${stats.totalCount}/${MAX_TOTAL_DRAWS}Âõû</div>`;
                console.log('Á∑èÊäΩÈÅ∏ÂõûÊï∞Âà∂ÈôêÂà∞ÈÅî');
            } else if (!stats.canDrawToday) {
                counterClass += ' limited';
                counterText = `<div class="count-numbers">„ÅÇ„Å®${stats.daysToWait}Êó•ÂæÖ„Å£„Å¶„Å≠</div><div>ÊäΩÈÅ∏ÂõûÊï∞: ${stats.totalCount}/${MAX_TOTAL_DRAWS}Âõû</div>`;
                console.log('ÂæÖÊ©üÊúüÈñì‰∏≠');
            } else {
                counterText = `<div class="count-numbers">ÊÆã„Çä<span class="remaining-count">${stats.remainingDraws}</span>Âõû</div><div>ÊäΩÈÅ∏ÂõûÊï∞: ${stats.totalCount}/${MAX_TOTAL_DRAWS}Âõû</div>`;
                console.log('ÊäΩÈÅ∏ÂèØËÉΩ');
            }
            
            drawCounter.className = counterClass;
            drawCounter.innerHTML = counterText;
            drawCounter.style.display = 'block';
            
            const submitBtn = document.querySelector('.code-submit-btn');
            submitBtn.disabled = !canProceed;
            
            console.log('ÊúÄÁµÇcanProceed:', canProceed);
            console.log('=== „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫Êõ¥Êñ∞ÂÆå‰∫Ü ===');
            
            return canProceed;
        }

        // ÁâπÂà•„Ç≥„Éº„ÉâÁîªÈù¢„ÇíË°®Á§∫
        function showEffortTicketScreen() {
            document.getElementById('code-screen').style.display = 'none';
            document.getElementById('effort-ticket-screen').style.display = 'block';
            document.getElementById('effort-ticket-code').value = '';
            document.getElementById('effort-ticket-error').style.display = 'none';
            
            // „Éï„Ç©„Éº„Ç´„Çπ„ÇíÂΩì„Å¶„Çã
            setTimeout(() => {
                document.getElementById('effort-ticket-code').focus();
            }, 100);
        }

        // ÁâπÂà•„Ç≥„Éº„Éâ„ÇíÁ¢∫Ë™ç
        function submitEffortTicketCode() {
            const code = document.getElementById('effort-ticket-code').value.trim();
            const errorDiv = document.getElementById('effort-ticket-error');
            
            if (code === SPECIAL_CODE) {
                // „Ç≥„Éº„ÉâÊ≠£Ëß£
                isEffortTicketMode = true;
                                 currentParticipant = 'ÁâπÂà•„Ç≥„Éº„ÉâÂà©Áî®ËÄÖ';
                
                document.getElementById('participant-info').textContent = `ÂèÇÂä†ËÄÖ: ${currentParticipant}`;
                
                // „Åè„ÅòÁîªÈù¢„Å´ÁßªÂãï
                document.getElementById('effort-ticket-screen').style.display = 'none';
                document.getElementById('kuji-screen').style.display = 'block';
                
                // ÊôØÂìÅÁîªÂÉè„ÇíÈùûË°®Á§∫
                document.body.classList.add('hide-keihin');
                
                // „Åè„Åò„ÇíÁîüÊàê
                generateKuji();
            } else {
                // „Ç≥„Éº„ÉâÈñìÈÅï„ÅÑ
                errorDiv.style.display = 'block';
                document.getElementById('effort-ticket-code').value = '';
                document.getElementById('effort-ticket-code').focus();
            }
        }

        // „É°„Ç§„É≥ÁîªÈù¢„Å´Êàª„Çã
        function backToMainScreen() {
            document.getElementById('effort-ticket-screen').style.display = 'none';
            document.getElementById('code-screen').style.display = 'block';
        }

        // „Åè„ÅòÈÅ∏ÊäûÁîªÈù¢„Åã„ÇâÊàª„Çã
        function backFromKujiScreen() {
            // „Åè„Åò„Ç≥„É≥„ÉÜ„Éä„Çí„ÇØ„É™„Ç¢
            document.getElementById('kuji-container').innerHTML = '';
            
            // ÊôØÂìÅÁîªÂÉè„ÇíÂÜçË°®Á§∫
            document.body.classList.remove('hide-keihin');
            
            // „Åè„ÅòÁîªÈù¢„ÇíÈùûË°®Á§∫
            document.getElementById('kuji-screen').style.display = 'none';
            
            // ÈÅ©Âàá„Å™ÁîªÈù¢„Å´Êàª„Çã
            if (isEffortTicketMode) {
                // ÁâπÂà•„Ç≥„Éº„Éâ„É¢„Éº„Éâ„ÅÆÂ†¥Âêà„ÅØÁâπÂà•„Ç≥„Éº„ÉâÁîªÈù¢„Å´Êàª„Çã
                document.getElementById('effort-ticket-screen').style.display = 'block';
            } else {
                // ÈÄöÂ∏∏„É¢„Éº„Éâ„ÅÆÂ†¥Âêà„ÅØ„É°„Ç§„É≥ÁîªÈù¢„Å´Êàª„Çã
                document.getElementById('code-screen').style.display = 'block';
            }
        }

        function submitCode() {
            const classSelect = document.getElementById('participant-class');
            const codeSelect = document.getElementById('participant-code');
            const selectedClass = classSelect.value;
            const selectedCode = codeSelect.value;
            
            if (selectedClass === '') {
                alert('„ÇØ„É©„Çπ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            if (selectedCode === '') {
                alert('Áï™Âè∑„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ');
                return;
            }
            
            // ÈÄöÂ∏∏„É¢„Éº„Éâ
            isEffortTicketMode = false;
            // ÂèÇÂä†ËÄÖÊÉÖÂ†±„Çí‰øùÂ≠òÔºà„ÇØ„É©„Çπ„ÉªÁï™Âè∑„ÅÆÂΩ¢ÂºèÔºâ
            currentParticipant = `${selectedClass}„Éª${selectedCode}`;
            
            // Âà∂Èôê„ÉÅ„Çß„ÉÉ„ÇØ
            if (!updateStatusDisplay(currentParticipant)) {
                return;
            }
            
            document.getElementById('participant-info').textContent = `ÂèÇÂä†ËÄÖ: ${currentParticipant}`;
            
            // „Åè„ÅòÁîªÈù¢„Å´ÁßªÂãï
            document.getElementById('code-screen').style.display = 'none';
            document.getElementById('kuji-screen').style.display = 'block';
            
            // ÊôØÂìÅÁîªÂÉè„ÇíÈùûË°®Á§∫
            document.body.classList.add('hide-keihin');
            
            // „Åè„Åò„ÇíÁîüÊàê
            generateKuji();
        }

        function startCelebration() {
            // Êó¢Â≠ò„ÅÆÊºîÂá∫„ÇíÂâäÈô§
            const existingCelebration = document.getElementById('celebration');
            if (existingCelebration) {
                existingCelebration.remove();
            }
            
            // Á•ùÁ¶èÊºîÂá∫„Ç≥„É≥„ÉÜ„Éä„Çí‰ΩúÊàê
            const celebration = document.createElement('div');
            celebration.id = 'celebration';
            celebration.className = 'celebration';
            document.body.appendChild(celebration);
            
            // Á¥ôÂêπÈõ™„ÇíÊôÇÈñìÂ∑Æ„ÅßÁîüÊàêÔºàÊúÄÂàù„ÅÆÂ§ßÈáèÁîüÊàêÔºâ
            for (let i = 0; i < 150; i++) {
                setTimeout(() => {
                    createConfetti(celebration);
                }, i * 100); // 100msÈñìÈöî„ÅßÁîüÊàê
            }
            
            // Á∂ôÁ∂öÁöÑ„Å´Á¥ôÂêπÈõ™„ÇíÁîüÊàêÔºàËøΩÂä†ÂàÜÔºâ
            const continuousConfetti = setInterval(() => {
                for (let i = 0; i < 5; i++) {
                    setTimeout(() => {
                        createConfetti(celebration);
                    }, i * 100);
                }
            }, 1000); // 1Áßí„Åî„Å®„Å´5ÂÄã„Åö„Å§ËøΩÂä†
            
            // 4ÁßíÂæå„Å´Á∂ôÁ∂öÁîüÊàê„ÇíÂÅúÊ≠¢
            setTimeout(() => {
                clearInterval(continuousConfetti);
            }, 4000);
            
            // „Ç≠„É©„Ç≠„É©„ÇíÁîüÊàê
            for (let i = 0; i < 30; i++) {
                createSparkle(celebration);
            }
            
            // 5ÁßíÂæå„Å´ÊºîÂá∫„ÇíÂâäÈô§
            setTimeout(() => {
                if (celebration && celebration.parentNode) {
                    celebration.remove();
                }
            }, 5000);
        }
        
        function createConfetti(container) {
            const confetti = document.createElement('div');
            confetti.className = 'confetti';
            confetti.style.left = Math.random() * 100 + '%';
            confetti.style.animationDuration = (Math.random() * 1 + 2) + 's';
            
            // „É©„É≥„ÉÄ„É†„Å™„Çµ„Ç§„Ç∫Ôºà8px„Äú16pxÔºâ
            const size = Math.random() * 8 + 8;
            confetti.style.width = size + 'px';
            confetti.style.height = size + 'px';
            
            container.appendChild(confetti);
        }
        
        function createSparkle(container) {
            const sparkle = document.createElement('div');
            sparkle.className = 'sparkle';
            sparkle.style.left = Math.random() * 100 + '%';
            sparkle.style.top = Math.random() * 100 + '%';
            sparkle.style.animationDelay = Math.random() * 2 + 's';
            // „É©„É≥„ÉÄ„É†„Å´‚òÖ„Åæ„Åü„ÅØ‚òÜ„ÇíË°®Á§∫
            sparkle.textContent = Math.random() > 0.5 ? '‚òÖ' : '‚òÜ';
            
            // ÈùíÁ∑ëÁ≥ª„ÅÆËâ≤„Çí„É©„É≥„ÉÄ„É†„Å´ÈÅ∏Êäû
            const colors = ['#00d2b8', '#00b8aa', '#1dd1a1', '#00cec9', '#00b894'];
            const color = colors[Math.floor(Math.random() * colors.length)];
            sparkle.style.color = color;
            
            container.appendChild(sparkle);
        }

        function resetGame() {
            // Êó¢Â≠ò„ÅÆÊºîÂá∫„ÇíÂâäÈô§
            const existingCelebration = document.getElementById('celebration');
            if (existingCelebration) {
                existingCelebration.remove();
            }
            
            // „Åè„ÅòÁîªÈù¢„Çí„É™„Çª„ÉÉ„Éà
            document.getElementById('kuji-container').innerHTML = '';
            document.getElementById('code-screen').style.display = 'block';
            document.getElementById('effort-ticket-screen').style.display = 'none';
            document.getElementById('kuji-screen').style.display = 'none';
            document.getElementById('confirm-screen').style.display = 'none';
            document.getElementById('drumroll-screen').style.display = 'none';
            document.getElementById('result-screen').style.display = 'none';
            
            // ÊôØÂìÅÁîªÂÉè„ÇíÂÜçË°®Á§∫
            document.body.classList.remove('hide-keihin');
            
            // ÂΩìÈÅ∏ËÄÖÊï∞Ë°®Á§∫„ÇíÂÜçË°®Á§∫
            document.body.classList.remove('hide-winner-count');
            
            // „Ç´„Ç¶„É≥„Éà„ÉÄ„Ç¶„É≥„Çí„É™„Çª„ÉÉ„Éà
            document.getElementById('countdown-display').textContent = '';
            
            // ÂãùËÄÖÊÉÖÂ†±„Çí„É™„Çª„ÉÉ„Éà
            document.getElementById('winner-info').style.display = 'none';
            
            // ÂèÇÂä†ËÄÖÊÉÖÂ†±„Çí„É™„Çª„ÉÉ„Éà
            currentParticipant = null;
            isEffortTicketMode = false;
            document.getElementById('participant-class').value = '';
            document.getElementById('participant-code').value = '';
            document.getElementById('participant-info').textContent = '';
            
            // ÁâπÂà•„Ç≥„Éº„ÉâÈñ¢ÈÄ£„ÇÇ„É™„Çª„ÉÉ„Éà
            document.getElementById('effort-ticket-code').value = '';
            document.getElementById('effort-ticket-error').style.display = 'none';
            
            // „Çπ„ÉÜ„Éº„Çø„ÇπË°®Á§∫„Çí„É™„Çª„ÉÉ„Éà
            document.getElementById('draw-counter').style.display = 'none';
            document.querySelector('.code-submit-btn').disabled = false;
        }

        // „ÇØ„É©„ÇπÈÅ∏Êäû„Å´Âøú„Åò„Å¶Áï™Âè∑„ÅÆÈÅ∏ÊäûËÇ¢„ÇíÊõ¥Êñ∞
        function updateNumberOptions() {
            const classSelect = document.getElementById('participant-class');
            const codeSelect = document.getElementById('participant-code');
            const selectedClass = classSelect.value;
            
            // „ÇØ„É©„Çπ„Åî„Å®„ÅÆÁï™Âè∑ÁØÑÂõ≤„ÇíÂÆöÁæ©
            const classNumbers = {
                "Kid's„Çº„Éü": 20,
                "„Éë„Ç∫„É´ÈÅìÂ†¥": 20,
                "3J": 5,
                "4S": 15,
                "5S": 15,
                "6S": 15,
                "4H": 5,
                "5H": 15,
                "6H": 15,
                "1A": 15,
                "2A": 10,
                "3A": 20
            };
            
            // Áï™Âè∑ÈÅ∏ÊäûËÇ¢„Çí„ÇØ„É™„Ç¢
            codeSelect.innerHTML = '<option value="">Áï™Âè∑„ÇíÈÅ∏Êäû</option>';
            
            if (selectedClass && classNumbers[selectedClass]) {
                const maxNumber = classNumbers[selectedClass];
                for (let i = 1; i <= maxNumber; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    codeSelect.appendChild(option);
                }
            }
        }

        // „Éö„Éº„Ç∏Ë™≠„ÅøËæº„ÅøÊôÇ„Å´ÂàùÊúüÂåñ
        window.addEventListener('load', () => {
            // ÁèæÂú®„ÅÆÊó•‰ªò„ÇíË°®Á§∫
            const now = new Date();
            const year = now.getFullYear();
            const month = now.getMonth() + 1;
            const day = now.getDate();
            const dateString = `${year}Âπ¥${month}Êúà${day}Êó•`;
            document.getElementById('date-display').textContent = dateString;
            
            // ÂΩìÈÅ∏ËÄÖÊï∞Ë°®Á§∫„ÇíÂàùÊúüÂåñ
            updateWinnerCountDisplay();
            
            // „Éï„Ç£„Éº„É´„ÉâÂ§âÊõ¥ÊôÇ„ÅÆÂà∂Èôê„ÉÅ„Çß„ÉÉ„ÇØ
            function checkLimits() {
                const classSelect = document.getElementById('participant-class');
                const codeSelect = document.getElementById('participant-code');
                
                if (classSelect.value && codeSelect.value) {
                    const participantId = `${classSelect.value}„Éª${codeSelect.value}`;
                    updateStatusDisplay(participantId);
                } else {
                    document.getElementById('draw-counter').style.display = 'none';
                    document.querySelector('.code-submit-btn').disabled = false;
                }
            }
            
            // „Éï„Ç£„Éº„É´„ÉâÂ§âÊõ¥ÊôÇ„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
            document.getElementById('participant-class').addEventListener('change', () => {
                updateNumberOptions();
                checkLimits();
            });
            document.getElementById('participant-code').addEventListener('change', checkLimits);
            
            // Enter„Ç≠„Éº„ÅßÁï™Âè∑ÈÅ∏Êäû„ÇíÂá¶ÁêÜ
            document.getElementById('participant-code').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    submitCode();
                }
            });
            
            // „ÇØ„É©„ÇπÈÅ∏Êäû„Åß„ÇÇEnter„Ç≠„Éº„ÇíÊúâÂäπÂåñ
            document.getElementById('participant-class').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    submitCode();
                }
            });

            // Á¢∫ÁéáË®≠ÂÆö„ÅÆÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„ÅÆ„Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº
            const probabilityInputs = ['prob-special', 'prob-1tou', 'prob-2tou', 'prob-3tou', 'prob-4tou', 'prob-5tou', 'prob-hazure'];
            probabilityInputs.forEach(id => {
                const input = document.getElementById(id);
                if (input) {
                    input.addEventListener('input', updateProbabilityTotal);
                }
            });

            // „Éë„Çπ„ÉØ„Éº„ÉâÂÖ•Âäõ„ÅßEnter„Ç≠„Éº„ÇíÊäº„Åó„ÅüÊôÇ„ÅÆÂá¶ÁêÜ
            document.getElementById('admin-password').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    checkPassword();
                }
            });

            // ÁâπÂà•„Ç≥„Éº„ÉâÂÖ•Âäõ„ÅßEnter„Ç≠„Éº„ÇíÊäº„Åó„ÅüÊôÇ„ÅÆÂá¶ÁêÜ
            document.getElementById('effort-ticket-code').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    submitEffortTicketCode();
                }
            });
        });

                // „Ç¶„Ç£„É≥„Éâ„Ç¶„Çµ„Ç§„Ç∫Â§âÊõ¥ÊôÇ„Å´„Åè„Åò„ÇíÂÜçÈÖçÁΩÆ
        window.addEventListener('resize', () => {
            if (document.getElementById('kuji-screen').style.display !== 'none') {
                document.getElementById('kuji-container').innerHTML = '';
                setTimeout(() => {
                    generateKuji();
                }, 100); // Â∞ë„ÅóÈÅÖÂª∂„Åï„Åõ„Å¶„É¨„Ç§„Ç¢„Ç¶„Éà„ÇíÁ¢∫ÂÆö
            }
        });

        // ÁÆ°ÁêÜÁîªÈù¢„ÇíÈñã„ÅèÔºà„Éë„Çπ„ÉØ„Éº„ÉâÂÖ•ÂäõÁîªÈù¢„ÇíË°®Á§∫Ôºâ
        function openAdminPanel() {
            document.getElementById('password-panel').style.display = 'flex';
            document.getElementById('admin-password').value = '';
            document.getElementById('password-error').style.display = 'none';
            
            // „Éë„Çπ„ÉØ„Éº„ÉâÂÖ•Âäõ„Éï„Ç£„Éº„É´„Éâ„Å´„Éï„Ç©„Éº„Ç´„Çπ
            setTimeout(() => {
                document.getElementById('admin-password').focus();
            }, 100);
        }

        // „Éë„Çπ„ÉØ„Éº„Éâ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
        function checkPassword() {
            const password = document.getElementById('admin-password').value;
            const errorDiv = document.getElementById('password-error');
            
            if (password === '66') {
                // „Éë„Çπ„ÉØ„Éº„ÉâÊ≠£Ëß£
                document.getElementById('password-panel').style.display = 'none';
                showAdminPanel();
            } else {
                // „Éë„Çπ„ÉØ„Éº„ÉâÈñìÈÅï„ÅÑ
                errorDiv.style.display = 'block';
                document.getElementById('admin-password').value = '';
                document.getElementById('admin-password').focus();
            }
        }

        // ÂÆüÈöõ„ÅÆÁÆ°ÁêÜÁîªÈù¢„ÇíË°®Á§∫
        function showAdminPanel() {
            document.getElementById('admin-panel').style.display = 'flex';
            loadAdminData();
            
            // Âº∑Âà∂„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅßÊúÄÊñ∞„Éá„Éº„Çø„ÇíË°®Á§∫
            forceRefreshAdmin();
            loadProbabilitySettings();
            loadClassSettings();
        }

        // „Éë„Çπ„ÉØ„Éº„ÉâÂÖ•ÂäõÁîªÈù¢„ÇíÈñâ„Åò„Çã
        function closePasswordPanel() {
            document.getElementById('password-panel').style.display = 'none';
        }

        // ÁÆ°ÁêÜÁîªÈù¢„ÇíÈñâ„Åò„Çã
        function closeAdminPanel() {
            document.getElementById('admin-panel').style.display = 'none';
        }

        // ÁÆ°ÁêÜ„Éá„Éº„Çø„ÇíË™≠„ÅøËæº„Åø
        function loadAdminData() {
            const history = getHistory();
            const adminData = document.getElementById('admin-data');
            
            if (Object.keys(history).length === 0) {
                adminData.innerHTML = '<p>„Åæ„Å†„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>';
                return;
            }

            // ÂèÇÂä†ËÄÖ„Çí„ÇØ„É©„Çπ„ÉªÁï™Âè∑È†Ü„Å´„ÇΩ„Éº„Éà
            const sortedParticipants = Object.keys(history).sort((a, b) => {
                const [classA, numberA] = a.split('„Éª');
                const [classB, numberB] = b.split('„Éª');
                
                // „ÇØ„É©„Çπ„ÅÆÈ†ÜÂ∫è„ÇíÂÆöÁæ©
                const classOrder = [
                    "Kid's„Çº„Éü", "„Éë„Ç∫„É´ÈÅìÂ†¥", "3J", 
                    "4S", "5S", "6S", 
                    "4H", "5H", "6H", 
                    "1A", "2A", "3A"
                ];
                
                const classIndexA = classOrder.indexOf(classA);
                const classIndexB = classOrder.indexOf(classB);
                
                // „ÇØ„É©„Çπ„ÅåÁï∞„Å™„ÇãÂ†¥Âêà„ÅØ„ÇØ„É©„ÇπÈ†Ü„ÅßÊØîËºÉ
                if (classIndexA !== classIndexB) {
                    return classIndexA - classIndexB;
                }
                
                // Âêå„Åò„ÇØ„É©„Çπ„ÅÆÂ†¥Âêà„ÅØÁï™Âè∑È†Ü„ÅßÊØîËºÉ
                return parseInt(numberA) - parseInt(numberB);
            });

            let tableHTML = `
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ÂèÇÂä†ËÄÖ</th>
                            <th>1ÂõûÁõÆ</th>
                            <th>2ÂõûÁõÆ</th>
                            <th>3ÂõûÁõÆ</th>
                            <th>4ÂõûÁõÆ</th>
                            <th>5ÂõûÁõÆ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            sortedParticipants.forEach(participantId => {
                const participant = history[participantId];
                
                // ÂΩìÈÅ∏Â±•Ê≠¥„ÇíÂèñÂæóÔºàÊó¢Â≠ò„Éá„Éº„Çø„ÅÆ‰∫íÊèõÊÄß„Çí‰øù„Å§Ôºâ
                const winHistory = participant.winHistory || [];
                
                tableHTML += `<tr><td>${participantId}</td>`;
                
                // 1ÂõûÁõÆ„Åã„Çâ5ÂõûÁõÆ„Åæ„Åß
                for (let i = 1; i <= 5; i++) {
                    let cellContent = '-';
                    let cellClass = '';
                    
                    if (i <= winHistory.length) {
                        const result = winHistory[i - 1];
                        if (result.prize === '„Éè„Ç∫„É¨') {
                            cellContent = '„Éè„Ç∫„É¨';
                            cellClass = 'result-miss';
                        } else {
                            // ÊôØÂìÅÂêç„ÅåË®òÈå≤„Åï„Çå„Å¶„ÅÑ„ÇãÂ†¥Âêà„ÅØË°®Á§∫
                            if (result.prizeName) {
                                cellContent = `${result.prize}<br><small>${result.prizeName}</small>`;
                            } else {
                                cellContent = result.prize;
                            }
                            cellClass = 'result-win';
                        }
                    }
                    
                    tableHTML += `<td class="${cellClass}">${cellContent}</td>`;
                }
                
                tableHTML += `</tr>`;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            adminData.innerHTML = tableHTML;
        }



        // ÊäΩÈÅ∏Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢
        function clearHistoryData() {
            if (confirm('Êú¨ÂΩì„Å´ÊäΩÈÅ∏Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åô„ÅãÔºü„Åì„ÅÆÊìç‰Ωú„ÅØÂèñ„ÇäÊ∂à„Åõ„Åæ„Åõ„Çì„ÄÇ\nÔºàÊôØÂìÅË®≠ÂÆö„Éª„ÇØ„É©„ÇπË®≠ÂÆö„ÅØÊÆã„Çä„Åæ„ÅôÔºâ\n\n‚Äª„ÇØ„É™„Ç¢Âæå„ÅØÂÖ®Âì°„ÅÆÂΩìÈÅ∏ÂõûÊï∞Âà∂Èôê„Åå„É™„Çª„ÉÉ„Éà„Åï„Çå„Åæ„Åô„ÄÇ')) {
                localStorage.removeItem(STORAGE_KEY);
                alert('ÊäΩÈÅ∏Â±•Ê≠¥„Çí„ÇØ„É™„Ç¢„Åó„Åæ„Åó„Åü„ÄÇÂÖ®Âì°„ÅÆÂΩìÈÅ∏ÂõûÊï∞Âà∂Èôê„Åå„É™„Çª„ÉÉ„Éà„Åï„Çå„Åæ„Åó„Åü„ÄÇ');
                loadAdminData();
                
                // ÂΩìÈÅ∏ËÄÖÊï∞Ë°®Á§∫„ÇíÊõ¥Êñ∞
                updateWinnerCountDisplay();
            }
        }

        // ÁÆ°ÁêÜÁîªÈù¢„ÅÆÂ§ñÂÅ¥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Åü„ÇâÈñâ„Åò„Çã
        document.getElementById('admin-panel').addEventListener('click', (e) => {
            if (e.target.id === 'admin-panel') {
                closeAdminPanel();
            }
        });

        // „Éë„Çπ„ÉØ„Éº„ÉâÂÖ•ÂäõÁîªÈù¢„ÅÆÂ§ñÂÅ¥„Çí„ÇØ„É™„ÉÉ„ÇØ„Åó„Åü„ÇâÈñâ„Åò„Çã
        document.getElementById('password-panel').addEventListener('click', (e) => {
            if (e.target.id === 'password-panel') {
                closePasswordPanel();
            }
        });
    </script>
</body>
</html> 